# 로또번호 추첨기 - 기능 명세서

**버전**: 4.2.0 | **최종 수정**: 2026-02-13 | **상태**: Phase 4 진행 중

> 본 문서는 순수 제품 명세 ("WHAT")만 기술. JavaScript API/데이터 구조는 `docs/tech.md` 참조.

> **섹션 인덱스** — `Read(offset, limit)` 참고
> 범위 L12 | F-001추첨 L24 | F-002표시 L38 | F-003이력 L62 | F-004다중 L88 | F-005제외 L105 | F-006복사 L126 | F-007인증 L144 | F-008다크모드 L163 | 비기능 L186 | 용어 L210

---

## 프로젝트 범위

**포함**: 1-45 로또번호 6개 무작위 추첨, 이력 관리, 여러 세트 동시 추첨, 수동 번호 제외, 사용자 인증(Phase 4)
**제외**: 실제 당첨 확인, 결제/구매 기능

**HTML 기본 정보**:
- 타이틀: `🎰 로또번호 추첨기` (h1에도 동일하게 이모지 포함)
- meta description: `1부터 45까지의 숫자 중 6개를 무작위로 추첨하는 웹 기반 로또번호 추첨기`
- 안내 텍스트 (p.info): `1부터 45까지의 숫자 중 6개를 무작위로 추첨합니다.`

---

## F-001: 기본 로또번호 추첨

**Phase**: 2 | **상태**: ✅ 완료

버튼 클릭 시 1~45에서 중복 없이 6개를 무작위 선택하여 오름차순 표시.

**제약사항**: 범위 1~45, 정확히 6개, 중복 불가, 오름차순, 응답 100ms 이하

**수용 기준**:
- [x] 항상 6개 생성, 1-45 범위, 중복 없음, 오름차순
- [ ] 100회 테스트 시 출현 빈도 균등

---

## F-002: 추첨 결과 표시

**Phase**: 2 | **상태**: ✅ 완료

생성된 번호를 색상 뱃지로 표시. 순차적 등장 애니메이션 (0.1초 간격).

**제약사항**: 좌→우 배치, 위치별 고유 색상 (design.md 참조), 모바일에서도 식별 가능

**세트 카드 DOM 구조**:

```
.set-card (div)
├── .set-label (div) — "N회차" 텍스트
├── .set-numbers (div) — 뱃지 래퍼 (flex, center, gap 8px, wrap)
│   ├── .number (div) — 숫자 뱃지 ×6 (위치별 색상, 순차 애니메이션)
│   └── ...
└── .copy-btn (button) — "📋 복사" 버튼, onclick → copyToClipboard(numbers, setIndex+1)
```

- 카드는 `#setsContainer` 안에 동적 생성 (`innerHTML = ''`로 초기화 후 생성)
- 애니메이션 딜레이: `(setIndex * 0.1) + (numIndex * 0.05)s` (JS에서 style.animationDelay 설정)

---

## F-003: 추첨 이력 저장

**Phase**: 3 | **상태**: ✅ 완료

추첨 번호를 타임스탬프와 함께 저장하고 조회. 최대 20개 (FIFO).

**제약사항**:
- 최대 20개, 초과 시 오래된 항목 삭제
- 비로그인: LocalStorage / 로그인: Supabase (듀얼 모드)

**UI 요구사항**:
- 토글 버튼 ("이력 보기 ▼" / "이력 숨기기 ▲")
- 전체 삭제 (confirm 다이얼로그)
- 빈 상태: "아직 추첨 이력이 없습니다."

**동작 상세**:
- **삭제 전 확인**: 빈 이력이면 `alert('삭제할 이력이 없습니다.')`로 사전 차단 → 삭제 진행 안 함
- **삭제 흐름**: `confirm()` → 삭제 실행 → `displayHistory()` 갱신 → `alert('이력이 삭제되었습니다.')`
- **자동 갱신**: 저장(`saveToHistory`) 후 이력 영역이 열려있으면(`hidden` 미포함) `displayHistory()` 자동 호출
- **날짜 표시 형식**: `YYYY-MM-DD HH:mm` (padStart로 2자리 보장), 다중세트일 때 `" (N세트 중)"` 접미사 추가
- **데이터 version 검증**: `loadHistoryLocal()`에서 `version !== '1.0'`이면 빈 배열 반환 (콘솔 경고)

**데이터 구조/API**: `docs/tech.md` 참조

---

## F-004: 여러 세트 동시 추첨

**Phase**: 3 | **상태**: ✅ 완료

1~5세트를 드롭다운으로 선택하여 동시 추첨. 각 세트는 독립적 (중복 가능).

**제약사항**: 1~5세트, 세트 간 중복 허용

**UI 요구사항**:
- 드롭다운 (`<select>`) 1~5 선택
- 카드 형태 구분, "N회차" 라벨
- 1~2개: 가로, 3+: 그리드 2열, 모바일: 세로 1열

**이력 저장**: 각 세트를 개별 항목으로 저장, `setCount` 필드에 총 세트 수 기록

---

## F-005: 수동 번호 제외

**Phase**: 3 | **상태**: ✅ 완료

사용자가 선택한 번호를 제외하고 추첨. 최대 39개 제외 (최소 6개 유지).

**제약사항**: 최대 제외 39개, 미달 시 경고 + 추첨 차단

**UI 요구사항**:
- 접이식 패널 ("번호 제외 설정 ▼" / "번호 제외 설정 ▲" 토글)
- 9열 토글 버튼 그리드 (클릭 시 제외/해제)
- 제외/남은 카운터 실시간 업데이트
  - 형식: `"제외: N개"` / `"남은 번호: N개"` (초기값: 0개 / 45개)
- 초기화 버튼, 경고 메시지 (`"최소 6개의 번호가 필요합니다."`, 남은 번호 < 6 시 표시)

**세션 유지**:
- 제외 번호는 LocalStorage에 자동 저장되어 새로고침 후에도 유지됨
- 초기화 시 LocalStorage도 함께 삭제됨

---

## F-006: 추첨 결과 복사

**Phase**: 3 | **상태**: ✅ 완료

Clipboard API로 추첨 결과를 복사. 개별 세트 복사만 지원 (전체 복사 미구현).

**제약사항**: Clipboard API 필요 (HTTPS 또는 localhost)

**UI 요구사항**:
- 각 세트 카드에 "📋 복사" 버튼
- 토스트 피드백 (2초 자동 사라짐)
- 토스트 중복 방지: 새 토스트 생성 전 기존 `.toast` 제거 (화면에 항상 1개만 존재)
- 토스트 제거 시 `fadeOut` 0.3s 애니메이션 후 DOM에서 삭제

**복사 형식**: `3, 12, 19, 27, 38, 42`

---

## F-007: 사용자 인증

**Phase**: 4 | **상태**: ✅ 코드 완료 (Supabase 설정 대기)

이메일/비밀번호 기반 인증. 로그인 시 Supabase 서버 저장, 비로그인 시 LocalStorage (듀얼 모드).

**입력**: 이메일, 비밀번호 (6자 이상)

**UI 요구사항**:
- 컨테이너 최상단 인증 섹션
- 비로그인: 토글 버튼 (`"로그인 / 회원가입 ▼"` / `"로그인 / 회원가입 ▲"`) → 이메일/비밀번호 폼
- 로그인: 이메일 표시 + 로그아웃 버튼

**듀얼 모드**: `saveToHistory`, `loadHistory`, `clearHistory`가 로그인 상태에 따라 Supabase/LocalStorage 분기

**API 상세**: `docs/tech.md` 참조

---

## F-008: 다크 모드

**Phase**: 3 (확장) | **상태**: ✅ 완료

라이트/다크 테마 전환. 사용자 선택을 LocalStorage에 저장하여 세션 유지.

**우선순위**: LocalStorage 저장값 > 시스템 설정(`prefers-color-scheme`) > light 기본값

**제약사항**:
- FOUC(Flash of Unstyled Content) 방지: CSS 로드 전에 테마 적용
- 모든 텍스트/뱃지 가독성 유지
- 480px 반응형에서도 정상 작동
- 시스템 테마 변경 실시간 감지: `matchMedia('prefers-color-scheme: dark')` change 이벤트 리스너로, LocalStorage 저장값이 없을 때만 시스템 설정 반영

**UI 요구사항**:
- 타이틀 오른쪽 토글 버튼 (🌙 / ☀️)
- 다크 모드 시 어두운 배경/카드, 밝은 텍스트
- 전환 트랜지션 (0.3s)

**데이터**: LocalStorage 키 `lotto_theme`, 값 `'light'` | `'dark'`

---

## 비기능 요구사항

| 항목 | 기준 |
|------|------|
| 응답 시간 | 100ms 이내 |
| 애니메이션 | 60fps |
| 메모리 | 10MB 이하 |
| 접근성 | Enter 키 추첨, 키보드 접근, ARIA 속성 |

### 접근성 ARIA 속성

| 요소 | 속성 | 값 | 목적 |
|------|------|-----|------|
| `#setsContainer` | `aria-live` | `polite` | 추첨 결과 변경 시 스크린 리더 알림 |
| `#excludeGrid` | `role` | `group` | 토글 버튼 그룹 의미 전달 |
| `#excludeGrid` | `aria-label` | `제외할 번호 선택` | 그룹 설명 |
| `#excludeWarning` | `role` | `alert` | 경고 메시지 즉시 알림 |
| `#setCount` | `aria-label` | `추첨 세트 수 선택` | select 설명 |
| `#btnGenerate` | `aria-label` | `로또번호 추첨하기` | 추첨 버튼 설명 |
| `#btnThemeToggle` | `aria-label` | `다크 모드 전환` / `라이트 모드 전환` | 테마 상태에 따라 동적 변경 |
| `.auth-input` 레이블 | `class` | `sr-only` | 시각적으로 숨기되 스크린 리더에 노출 |

---

## 용어 정의

| 용어 | 정의 |
|------|------|
| 로또번호 | 1~45 정수 |
| 세트 | 6개 번호 조합 |
| 추첨 | 무작위 선택 행위 |
| 이력 | 과거 추첨 기록 |

---

**테스트**: `test/README.md` 참조 | **관련 문서**: [tech.md](./tech.md), [design.md](./design.md), [plan.md](./plan.md)
