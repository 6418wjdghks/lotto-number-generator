# 로또번호 추첨기 - 기능 명세서

## 📋 문서 정보

- **버전**: 2.1.0
- **작성일**: 2026-02-11
- **최종 수정**: 2026-02-11
- **상태**: Phase 4 진행 중

---

## 🎯 프로젝트 범위

### 포함 항목
- 1-45 범위의 로또번호 6개 무작위 추첨
- 추첨 이력 관리 (Phase 3)
- 여러 세트 동시 추첨 (Phase 3)
- 수동 번호 제외 (Phase 3)

### 제외 항목
- 실제 당첨 확인 기능
- ~~서버 연동 및 데이터베이스~~ → Phase 4에서 Supabase 도입
- ~~사용자 인증/로그인~~ → Phase 4에서 이메일 인증 도입
- 결제 기능
- 번호 구매 기능

---

## 💎 핵심 기능 명세

### F-001: 기본 로또번호 추첨

**우선순위**: P0 (필수)
**Phase**: 2

#### 설명
사용자가 버튼을 클릭하면 1부터 45까지의 숫자 중 중복 없이 6개를 무작위로 선택하여 표시합니다.

#### 입력
- 사용자 액션: "추첨하기" 버튼 클릭

#### 처리 로직
1. 1부터 45까지의 정수 배열 생성
2. 배열을 무작위로 섞음 (Fisher-Yates 알고리즘)
3. 배열의 첫 6개 요소 선택
4. 선택된 숫자를 오름차순으로 정렬
5. 화면에 표시

#### 출력
- 6개의 정수 (1 ≤ n ≤ 45)
- 오름차순 정렬
- 중복 없음
- 각 숫자는 구분된 시각적 요소로 표시

#### 제약사항
- **숫자 범위**: 1 ≤ n ≤ 45 (한국 로또 규칙)
- **추첨 개수**: 정확히 6개
- **중복**: 허용 안 함
- **정렬**: 오름차순 필수
- **응답 시간**: 100ms 이하

#### 예외 처리
- 없음 (입력이 없으므로 항상 유효한 결과 생성)

#### 성공 기준
- [x] 항상 6개의 숫자 생성
- [x] 모든 숫자가 1-45 범위 내
- [x] 중복된 숫자 없음
- [x] 오름차순 정렬
- [ ] 100회 테스트 시 모든 숫자의 출현 빈도가 균등

#### 예시
```
입력: [추첨하기 버튼 클릭]
출력: 3, 12, 19, 27, 38, 42
```

---

### F-002: 추첨 결과 표시

**우선순위**: P0 (필수)
**Phase**: 2

#### 설명
생성된 로또번호를 사용자에게 시각적으로 명확하게 표시합니다.

#### 입력
- 6개의 정수 배열 (F-001의 출력)

#### 처리 로직
1. 기존 표시된 숫자 제거
2. 각 숫자에 대해:
   - 시각적 요소(뱃지) 생성
   - 숫자 텍스트 설정
   - 순차적 등장 애니메이션 적용
3. DOM에 추가

#### 출력
- 6개의 숫자 뱃지
- 순차적 등장 효과 (0.1초 간격)

#### 제약사항
- 숫자는 좌에서 우로 배치
- 각 숫자는 구분된 색상으로 표시
- 모바일에서도 명확하게 식별 가능

---

### F-003: 추첨 이력 저장

**우선순위**: P1 (높음)
**Phase**: 3
**상태**: ✅ 완료 (2026-02-11)

#### 설명
사용자가 추첨한 번호 이력을 로컬에 저장하고 조회할 수 있습니다.

#### 입력
- 추첨된 번호 배열
- 추첨 일시 (자동 생성)

#### 처리 로직
1. 추첨 결과를 타임스탬프와 함께 저장
2. LocalStorage에 JSON 형태로 저장
3. 최대 20개까지 저장 (오래된 것부터 삭제)

#### 출력
- 저장된 이력 목록
- 각 항목: 날짜, 시간, 번호

#### 제약사항
- 최대 저장 개수: 20개
- 저장소: LocalStorage
- 데이터 형식: JSON

#### 데이터 구조
```json
{
  "version": "1.0",
  "history": [
    {
      "id": "uuid-v4",
      "numbers": [3, 12, 19, 27, 38, 42],
      "timestamp": "2026-02-11T10:30:00.000Z",
      "setCount": 1
    }
  ]
}
```

**필드 설명**:
- `version`: 데이터 포맷 버전 (마이그레이션 대비)
- `id`: 고유 식별자 (UUID v4)
- `numbers`: 추첨된 숫자 배열 (길이 6, 오름차순)
- `timestamp`: ISO 8601 형식의 추첨 시간
- `setCount`: 동시 추첨 세트 수 (F-004 기능, 기본값 1)

#### UI 요구사항
- **이력 표시 영역**: 추첨 결과 아래에 배치
- **토글 버튼**: "이력 보기" / "이력 숨기기"
- **이력 항목 형식**:
  ```
  2026-02-11 10:30  |  3, 12, 19, 27, 38, 42
  ```
- **전체 삭제 버튼**: "전체 삭제" (확인 다이얼로그 포함)
- **빈 상태**: "아직 추첨 이력이 없습니다."

#### JavaScript API 명세

**`saveToHistory(numbers, setCount = 1)`**
- **매개변수**:
  - `numbers` (Array<number>) - 추첨된 숫자 배열
  - `setCount` (number) - 동시 추첨 세트 수 (기본값: 1)
- **반환**: void
- **동작**:
  1. LocalStorage에서 기존 데이터 로드
  2. 새 항목 생성 (id, timestamp 자동 생성)
  3. history 배열 맨 앞에 추가
  4. 20개 초과 시 오래된 항목 제거
  5. LocalStorage에 저장

**`loadHistory()`**
- **매개변수**: 없음
- **반환**: Array<HistoryItem> - 이력 배열
- **동작**:
  1. LocalStorage에서 'lotto_history' 조회
  2. JSON 파싱 (에러 시 빈 배열 반환)
  3. version 검증
  4. history 배열 반환

**`displayHistory()`**
- **매개변수**: 없음
- **반환**: void
- **동작**:
  1. loadHistory() 호출
  2. DOM에 이력 항목 렌더링
  3. 빈 상태 처리

**`clearHistory()`**
- **매개변수**: 없음
- **반환**: void
- **동작**:
  1. 사용자 확인 다이얼로그
  2. LocalStorage에서 'lotto_history' 삭제
  3. 화면 갱신

**`toggleHistoryView()`**
- **매개변수**: 없음
- **반환**: void
- **동작**: 이력 영역 표시/숨김 토글

#### LocalStorage Key
- **Key**: `lotto_history`
- **Value**: JSON string (위 데이터 구조)

#### 예외 처리
- LocalStorage 접근 실패: 콘솔 에러, 기능 무시
- JSON 파싱 에러: 빈 배열 반환
- 용량 초과: 오래된 항목 삭제 후 재시도

---

### F-004: 여러 세트 동시 추첨

**우선순위**: P1 (높음)
**Phase**: 3
**상태**: ✅ 완료 (2026-02-11)

#### 설명
한 번의 클릭으로 여러 세트의 로또번호를 동시에 추첨합니다.

#### 입력
- 사용자 선택: 세트 수 (1-5)

#### 처리 로직
1. 사용자가 선택한 세트 수만큼 반복
2. 각 세트마다 F-001 로직 실행
3. 모든 결과를 화면에 표시

#### 출력
- N개의 로또번호 세트 (N = 1~5)
- 각 세트는 구분되어 표시

#### 제약사항
- 최소 세트: 1개
- 최대 세트: 5개
- 세트 간 중복 가능 (독립적 추첨)

#### UI 요구사항
- **세트 수 선택**: 드롭다운 (`<select>`) 1~5개 선택
- **세트 컨테이너**: 각 세트는 카드 형태로 구분
- **세트 번호**: "1회차", "2회차", ... 라벨 표시
- **레이아웃**:
  - 1~2개: 가로 배치
  - 3개 이상: 그리드 레이아웃 (2열)

#### JavaScript API 명세

**`generateMultipleSets(count)`**
- **매개변수**: `count` (number) - 생성할 세트 수 (1~5)
- **반환**: Array<Array<number>> - 세트 배열
- **동작**:
  1. count만큼 반복하여 로또번호 생성
  2. 각 세트는 독립적으로 추첨 (중복 가능)
  3. 2차원 배열 반환

**`displayMultipleSets(sets)`**
- **매개변수**: `sets` (Array<Array<number>>) - 세트 배열
- **반환**: void
- **동작**:
  1. 기존 표시 영역 초기화
  2. 각 세트마다 카드 생성
  3. 세트 번호 라벨 추가
  4. 숫자 뱃지 렌더링
  5. 순차 애니메이션 적용

**`getSelectedSetCount()`**
- **매개변수**: 없음
- **반환**: number - 선택된 세트 수
- **동작**: 드롭다운 값 조회

#### 데이터 흐름
```
사용자 드롭다운 선택 (예: 3)
  ↓
generateLottoNumbers() 호출
  ↓
getSelectedSetCount() → 3
  ↓
generateMultipleSets(3) → [[1,2,3,4,5,6], [7,8,9,10,11,12], ...]
  ↓
displayMultipleSets(sets)
  ↓
saveToHistory(sets[0]) (각 세트 개별 저장)
```

#### 이력 저장 방식
- 각 세트를 **개별 이력 항목**으로 저장
- `setCount` 필드에 총 세트 수 기록
- 예: 3세트 추첨 시 → 3개 이력 항목 생성 (각각 `setCount: 3`)

#### 제약사항 상세
- 세트 수 범위 검증: 1~5
- 각 세트는 완전히 독립적 (같은 번호 조합 가능)
- 모바일에서는 세로 배치 (1열)

---

### F-005: 수동 번호 제외

**우선순위**: P2 (중간)
**Phase**: 3
**상태**: ✅ 완료 (2026-02-11)

#### 설명
사용자가 특정 번호를 제외하고 추첨할 수 있습니다.

#### 입력
- 제외할 번호 목록 (사용자 선택)

#### 처리 로직
1. 1-45 범위에서 제외 번호를 뺀 배열 생성
2. 남은 숫자가 6개 이상인지 검증
3. F-001과 동일한 로직으로 추첨

#### 출력
- 제외된 번호를 제외한 6개의 로또번호

#### 제약사항
- 최대 제외 가능 번호: 39개 (최소 6개는 남아야 함)
- 제외 번호 입력 방법: 토글 버튼 그리드 (9×5)

#### 검증 규칙
- 제외 번호가 39개를 초과하면 경고 표시 + 추첨 차단
- "최소 6개의 번호가 필요합니다" 메시지

#### UI 요구사항
- **접이식 섹션**: "번호 제외 설정" 토글 버튼으로 패널 열기/닫기
- **번호 그리드**: 1~45 숫자를 9열 그리드로 표시, 클릭하면 제외/해제 토글
- **카운터**: "제외: N개 / 남은 번호: M개" 실시간 업데이트
- **초기화 버튼**: 모든 제외 해제
- **경고**: 남은 번호 < 6일 때 빨간색 경고 메시지

#### JavaScript API 명세

**`getExcludedNumbers()`**
- **매개변수**: 없음
- **반환**: Array<number> - 제외된 번호 배열
- **동작**: `.exclude-btn.excluded` 클래스를 가진 버튼의 숫자 수집

**`toggleExcludeView()`**
- **매개변수**: 없음
- **반환**: void
- **동작**: 패널 표시/숨김 토글, 최초 열기 시 45개 버튼 그리드 생성

**`updateExcludeCount()`**
- **매개변수**: 없음
- **반환**: void
- **동작**: 제외/남은 카운터 업데이트, 경고 표시/숨김

**`resetExcludedNumbers()`**
- **매개변수**: 없음
- **반환**: void
- **동작**: 모든 제외 해제, 카운터 리셋

---

### F-006: 추첨 결과 복사

**우선순위**: P2 (중간)
**Phase**: 3
**상태**: ✅ 완료 (2026-02-11)
**참고**: `copyAllSets()` (전체 복사) 기능은 미구현. 개별 세트 복사만 지원.

#### 설명
추첨 결과를 클립보드에 복사하여 다른 곳에 붙여넣을 수 있습니다.

#### 입력
- 사용자 액션: "복사" 버튼 클릭

#### 처리 로직
1. 현재 표시된 번호를 텍스트로 변환
2. Clipboard API 사용하여 복사
3. 성공 피드백 표시

#### 출력
- 클립보드: "3, 12, 19, 27, 38, 42"
- 사용자 피드백: "복사되었습니다!" 토스트 메시지

#### 제약사항
- 브라우저가 Clipboard API를 지원해야 함
- HTTPS 환경 필요 (또는 localhost)

#### UI 요구사항
- **복사 버튼 위치**: 각 세트 카드에 개별 복사 버튼
- **버튼 아이콘**: 📋 또는 "복사" 텍스트
- **피드백 방식**: 토스트 메시지 (2초 자동 사라짐)
- **여러 세트 복사**: "전체 복사" 버튼 추가 (모든 세트 한번에)

#### JavaScript API 명세

**`copyToClipboard(numbers, setNumber = null)`**
- **매개변수**:
  - `numbers` (Array<number>) - 복사할 숫자 배열
  - `setNumber` (number|null) - 세트 번호 (선택, 여러 세트일 때)
- **반환**: Promise<boolean> - 성공 여부
- **동작**:
  1. 숫자 배열을 텍스트로 변환 ("3, 12, 19, 27, 38, 42")
  2. Clipboard API 호출
  3. 성공 시 토스트 표시
  4. 실패 시 에러 처리

**`showToast(message, type, duration)`**
- **매개변수**:
  - `message` (string) - 표시할 메시지
  - `type` (string) - 토스트 타입 ('success' 또는 'error', 기본값: 'success')
  - `duration` (number) - 표시 시간 (ms, 기본값: 2000)
- **반환**: void
- **동작**: 토스트 메시지 생성 및 자동 제거

> **참고**: `copyAllSets()` (전체 복사) 기능은 미구현. 필요 시 Phase 4에서 검토.

#### 복사 형식

**단일 세트**:
```
3, 12, 19, 27, 38, 42
```

**여러 세트** (예: 3개):
```
[1회차] 3, 12, 19, 27, 38, 42
[2회차] 7, 15, 23, 31, 39, 44
[3회차] 5, 10, 20, 25, 35, 40
```

#### 에러 처리
- Clipboard API 미지원: "복사 기능을 지원하지 않는 브라우저입니다."
- 복사 실패: "복사에 실패했습니다. 다시 시도해주세요."
- HTTPS 필요: "보안 연결(HTTPS)에서만 사용 가능합니다."

---

## 🧪 테스트

2계층 자동 테스트 (CLI 23개 + 브라우저 11개, 중복 없음, 100% 커버리지) 상세: `test/README.md` 참조

- **CLI**: `node --test test/test-logic.js` — 순수 로직 (Node.js 18+, 외부 의존성 없음)
- **브라우저**: `test/test.html` — DOM/UI 전용 테스트

---

## 📊 비기능 요구사항

### 성능
- **응답 시간**: 버튼 클릭 후 100ms 이내 결과 표시
- **애니메이션**: 60fps 유지
- **메모리**: 최대 10MB 이하

### 사용성
- **접근성**: 버튼 클릭 또는 Enter 키로 추첨 가능
- **피드백**: 버튼 클릭 시 즉각적인 시각적 피드백
- **명확성**: 추첨 결과가 명확하게 구분됨

### 신뢰성
- **정확성**: 항상 올바른 범위의 숫자 생성
- **재현성**: 동일한 조건에서 일관된 동작
- **안정성**: 오류 없이 연속 실행 가능

---

## 📝 용어 정의

| 용어 | 정의 |
|------|------|
| 로또번호 | 1부터 45까지의 정수 중 하나 |
| 세트 | 6개의 로또번호 조합 |
| 추첨 | 무작위로 숫자를 선택하는 행위 |
| 이력 | 과거에 추첨한 번호 기록 |

---

## 🔄 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 2.1.0 | 2026-02-11 | F-003/004/006 상태 완료, v2 테스트 시나리오 추가 | - |
| 2.0.0 | 2026-02-11 | Phase 3 - F-003 이력 저장 기능 명세 추가 | - |
| 1.0.0 | 2026-02-11 | 초기 문서 작성 | - |

---

---

### F-007: 사용자 인증 (이메일 로그인/회원가입)

**우선순위**: P1 (높음)
**Phase**: 4
**상태**: ✅ 코드 완료 (Supabase 프로젝트 설정 대기)

#### 설명
이메일/비밀번호 기반 회원가입 및 로그인. 로그인 시 이력이 서버(Supabase)에 저장되고, 비로그인 시 기존 LocalStorage 모드 유지 (듀얼 모드).

#### 입력
- 이메일 (email input)
- 비밀번호 (password input, 6자 이상)

#### 처리 로직
1. Supabase Auth REST API (`/auth/v1/signup`, `/auth/v1/token`) 호출
2. 세션(access_token, user)을 LocalStorage에 저장
3. 로그인/비로그인 UI 전환

#### UI 요구사항
- **인증 섹션**: 컨테이너 최상단 (세트 선택 위)
- **비로그인 상태**: "로그인 / 회원가입" 토글 버튼 → 이메일/비밀번호 폼
- **로그인 상태**: 이메일 표시 + 로그아웃 버튼

#### JavaScript API 명세

**`toggleAuthForm()`** - 로그인 폼 토글
**`handleSignIn()`** - (async) 로그인 처리 + UI 전환
**`handleSignUp()`** - (async) 회원가입 처리
**`handleSignOut()`** - (async) 로그아웃 + UI 전환
**`updateAuthUI()`** - 로그인/비로그인 UI 상태 반영
**`initApp()`** - 페이지 로드 시 세션 확인

#### 듀얼 모드 함수 (F-003 확장)

- **`saveToHistory(numbers, setCount)`**: (async) 로그인 → Supabase `insertHistory()`, 비로그인 → `saveToHistoryLocal()`
- **`loadHistory()`**: (async) 로그인 → Supabase `fetchHistory()`, 비로그인 → `loadHistoryLocal()`
- **`clearHistory()`**: (async) 로그인 → Supabase `deleteAllHistory()`, 비로그인 → `clearHistoryLocal()`

#### Supabase REST API 래퍼 (`js/supabase-config.js`)

전역 객체 `window.supabase`로 노출:
- `getSession()`, `saveSession()`, `clearSession()`, `isLoggedIn()`
- `signUp(email, password)`, `signIn(email, password)`, `signOut()`, `getUser()`
- `fetchHistory(limit)`, `insertHistory(numbers, setCount)`, `deleteAllHistory()`

---

**관련 문서**: [plan.md](./plan.md), [design.md](./design.md), [tech.md](./tech.md)
