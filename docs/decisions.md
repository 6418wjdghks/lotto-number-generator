# 아키텍처 결정 기록 (Architecture Decision Records)

프로젝트의 주요 설계 결정과 그 사유를 기록합니다.

> 과거 ADR: [decisions_001_010.md](./decisions_001_010.md) (ADR-001~010)

---

## 목차

| # | 결정 | 상태 | 날짜 |
|---|------|------|------|
| [011](#adr-011) | 문서 중복 제거 리팩토링 | 적용 완료 | 2026-02-11 |
| [012](#adr-012) | phase4-plan → phase4-architecture 이름 변경 | 적용 완료 | 2026-02-11 |
| [013](#adr-013) | 번호 제외 UI: 토글 버튼 그리드 | 유지 | 2026-02-11 |
| [014](#adr-014) | 2계층 테스트 아키텍처 (CLI + 브라우저) | 유지 | 2026-02-11 |
| [015](#adr-015) | 파생 수치 단일 소스 규칙 | 유지 | 2026-02-11 |
| [016](#adr-016) | Supabase REST API 직접 호출 (SDK 미사용) | 유지 | 2026-02-12 |
| [017](#adr-017) | 문서 전면 구조 개편 — 토큰 사용량 48% 감소 | 적용 완료 | 2026-02-12 |

---

## ADR-011: 문서 중복 제거 리팩토링

**날짜**: 2026-02-11
**상태**: 적용 완료

### 맥락
프로젝트 문서 7개 파일에서 14개 중복 항목이 발견되었다. 특히 CLAUDE.md(~380줄)는 매 세션 로드되어 토큰 낭비가 심했다.

### 결정
"단일 진실 소스(Single Source of Truth)" 원칙을 적용. 각 문서에 명확한 역할을 부여하고, 중복 내용은 원본 참조로 대체.

### 결과
전체 문서 1,898줄 → 1,163줄 (39% 감소)

---

## ADR-012: phase4-plan → phase4-architecture 이름 변경

**날짜**: 2026-02-11
**상태**: 적용 완료
**관련 커밋**: `4c1e7b1`

### 맥락
`docs/phase4-plan.md`와 `docs/plan.md`가 이름만 보면 둘 다 "계획" 문서로 보였다. 실제로는 역할이 완전히 달랐다.

### 결정
`phase4-plan.md` → `phase4-architecture.md`로 이름 변경. plan = 진행 관리, architecture = 기술 설계.

---

## ADR-013: 번호 제외 UI: 토글 버튼 그리드

**날짜**: 2026-02-11 (Phase 3, Step 4)
**상태**: 유지
**명세**: `docs/spec.md` F-005

### 맥락
F-005 수동 번호 제외 기능에서 사용자가 제외할 번호를 선택하는 UI 방식을 정해야 했다.

### 결정
1~45 숫자를 9열 그리드의 토글 버튼으로 표시한다. 클릭하면 제외/해제가 토글된다.

### 사유
- **직관성**: 숫자를 보면서 바로 클릭. 입력값 검증이 불필요
- **터치 친화적**: 모바일에서 버튼 탭이 텍스트 입력보다 편리
- **시각적 피드백**: 제외된 번호가 즉시 회색 + 취소선으로 표시
- **기존 UI와 일관성**: 이력 섹션과 동일한 접이식(토글) 패턴 재사용

### 검토한 대안
- **체크박스 목록**: 45개 체크박스를 나열. 공간을 많이 차지하고 시각적 매력이 낮음
- **텍스트 입력**: 콤마로 구분된 숫자 직접 입력. 컴팩트하지만 입력 검증이 복잡하고 오타 위험

---

## ADR-014: 2계층 테스트 아키텍처 (CLI + 브라우저)

**날짜**: 2026-02-11
**상태**: 유지

### 맥락
기존 테스트(`test/test.html`)는 브라우저에서만 실행 가능하여 자동화가 어려웠다.

### 결정
2계층 테스트 구조를 도입한다:
- **계층 1** (`test/test-logic.js`): Node.js `node:test`로 순수 로직 테스트 (CLI 실행)
- **계층 2** (`test/test.html`): 브라우저에서 DOM/UI 테스트 (기존 유지)

### 사유
- **CI 연동**: `node --test test/test-logic.js`로 exit code 0/1 반환
- **외부 의존성 없음**: Node.js 18+ 내장 `node:test` 사용
- **빠른 피드백**: CLI 테스트는 브라우저 없이 즉시 실행 (~1초)
- **관심사 분리**: 순수 로직은 CLI, DOM 의존 기능은 브라우저

### app.js 호환성
```javascript
if (typeof module !== 'undefined' && module.exports) {
  module.exports = { ... };
}
```

---

## ADR-015: 파생 수치 단일 소스 규칙

**날짜**: 2026-02-11
**상태**: 유지

### 맥락
문서 점검 결과 17건의 명세-구현 불일치가 발견되었다. 근본 원인 중 하나가 코드에서 파생되는 수치(함수 수, 테스트 수)가 여러 문서에 중복 기록된 것이었다.

### 결정
코드에서 파생되는 수치는 단일 소스에만 기록한다.

| 수치 | 단일 소스 | 다른 문서 |
|------|----------|---------|
| 함수 목록/수 | CLAUDE.md API 테이블 | "CLAUDE.md 참조" |
| 테스트 수/항목 | test/README.md | "test/README.md 참조" |
| 파일 줄 수 | 기록하지 않음 | - |

---

## ADR-016: Supabase REST API 직접 호출 (SDK 미사용)

**날짜**: 2026-02-12 (Phase 4)
**상태**: 유지
**코드**: `js/supabase-config.js`

### 맥락
Phase 4에서 Supabase를 백엔드로 도입할 때, SDK(`@supabase/supabase-js`)를 사용할지, 순수 `fetch()` + REST API로 직접 호출할지 결정해야 했다.

### 결정
순수 `fetch()` + Supabase REST API를 직접 호출한다. API 래퍼를 `js/supabase-config.js`에 IIFE로 구현하고 `window.supabase` 전역 객체로 노출.

### 사유
- **ADR-001 일관성**: "순수 JavaScript만 사용 — 프레임워크/라이브러리 금지" 원칙 유지
- **빌드 불필요**: 브라우저 내장 `fetch()`만 사용
- **학습 가치**: REST API 직접 호출로 HTTP 인증 흐름 이해
- **번들 크기 0**: SDK(~40KB gzip) 불필요

### 제약사항
- **토큰 갱신 미구현**: 세션 만료 시 재로그인 필요. 필요 시 추후 추가
- **세션 보안**: access_token을 LocalStorage에 저장 (Supabase SDK도 동일 방식)

### 재검토 조건
실시간 기능, 파일 스토리지, OAuth 등이 필요해지면 SDK 도입 재검토

---

## ADR-017: 문서 전면 구조 개편 — 토큰 사용량 48% 감소

**날짜**: 2026-02-12
**상태**: 적용 완료

### 맥락
매 세션 CLAUDE.md(211줄)가 자동 로드되고, 작업 시 2~4개 문서를 추가로 읽어야 해서 컨텍스트가 빠르게 차오르는 문제가 있었다. 8개 문서 총 3,919줄.

### 결정
문서 역할을 재정의하고 중복/사문화된 내용을 대폭 제거한다.

### 핵심 변경
1. **spec.md**: JavaScript API/데이터구조 → tech.md 이동. 순수 제품 명세만 유지
2. **tech.md**: spec.md에서 API 흡수, 불필요 섹션(코드 품질, 개발환경, 배포 명령) 제거
3. **design.md**: CSS 코드블록 전량 삭제 → 컴포넌트 명세 테이블로 대체
4. **phase4-architecture.md**: 미채택 아키텍처 옵션(Option 1/2) 삭제
5. **decisions.md**: ADR-001~010 → `decisions_001_010.md` 아카이브
6. **CLAUDE.md**: 파일구조/진행바/Supabase API 제거, 참조 방식 전환

### 사유
- **토큰 절감**: 3,919줄 → ~2,020줄 (48% 감소)
- **역할 명확화**: spec.md = WHAT, tech.md = HOW
- **CSS 중복 제거**: design.md에서 style.css 복사본 ~800줄 삭제
- **사문화 방지**: 미채택 옵션, 완료된 체크리스트 정리
