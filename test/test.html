<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¡œë˜ë²ˆí˜¸ ì¶”ì²¨ê¸° - ìë™ í…ŒìŠ¤íŠ¸ v2</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    /* í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ (app ìŠ¤íƒ€ì¼ ìœ„ì— ì˜¤ë²„ë¼ì´ë“œ) */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
      min-height: auto;
      display: block;
    }

    h1 {
      color: #333;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
      font-size: 1.8em;
      margin-bottom: 10px;
    }

    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .test-section h2 {
      color: #667eea;
      margin-top: 0;
    }

    .result {
      padding: 10px 15px;
      margin: 5px 0;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    .result.pass {
      background: #d4edda;
      border-left: 4px solid #28a745;
      color: #155724;
    }

    .result.fail {
      background: #f8d7da;
      border-left: 4px solid #dc3545;
      color: #721c24;
    }

    .result.info {
      background: #d1ecf1;
      border-left: 4px solid #0c5460;
      color: #0c5460;
    }

    .result.separator {
      background: transparent;
      border: none;
      padding: 2px;
      margin: 0;
    }

    .test-controls button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 15px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }

    .test-controls button:hover {
      opacity: 0.9;
      transform: none;
      box-shadow: none;
    }

    .summary-bar {
      display: flex;
      gap: 15px;
      padding: 15px 20px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      margin-top: 15px;
    }

    .summary-bar.all-pass {
      background: #d4edda;
      color: #155724;
    }

    .summary-bar.has-fail {
      background: #f8d7da;
      color: #721c24;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }

    .stat-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      border-left: 4px solid #667eea;
    }

    .stat-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #333;
    }

    /* DOM Fixture ì˜ì—­ - í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œë§Œ ì‚¬ìš© */
    #testFixture {
      display: none !important;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª ë¡œë˜ë²ˆí˜¸ ì¶”ì²¨ê¸° - ìë™ í…ŒìŠ¤íŠ¸ v2</h1>

  <!--
    DOM Fixture: app.jsê°€ ì°¸ì¡°í•˜ëŠ” DOM ìš”ì†Œë“¤.
    ì‹¤ì œ index.htmlì˜ êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ì¬í˜„í•©ë‹ˆë‹¤.
  -->
  <div id="testFixture">
    <select id="setCount">
      <option value="1" selected>1ê°œ</option>
      <option value="2">2ê°œ</option>
      <option value="3">3ê°œ</option>
      <option value="4">4ê°œ</option>
      <option value="5">5ê°œ</option>
    </select>
    <div class="sets-container" id="setsContainer"></div>
    <div id="historyList" class="history-list hidden"></div>
    <span id="historyToggleText">ì´ë ¥ ë³´ê¸° â–¼</span>
    <span id="excludeToggleText">ë²ˆí˜¸ ì œì™¸ ì„¤ì • â–¼</span>
    <div id="excludePanel" class="exclude-panel hidden">
      <span id="excludeCount">ì œì™¸: 0ê°œ</span>
      <span id="remainCount">ë‚¨ì€ ë²ˆí˜¸: 45ê°œ</span>
      <div class="exclude-grid" id="excludeGrid"></div>
      <div id="excludeWarning" class="exclude-warning hidden"></div>
    </div>
  </div>

  <div class="test-section">
    <h2>í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤</h2>
    <div class="test-controls">
      <button onclick="runAllTests()">ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
      <button onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="test-section">
    <h2>í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
    <div id="testResults"></div>
    <div id="summaryBar"></div>
  </div>

  <div class="test-section">
    <h2>ë¶„í¬ í†µê³„ (1000íšŒ ì¶”ì²¨)</h2>
    <div class="stats" id="stats"></div>
  </div>

  <script src="../js/app.js"></script>
  <script>
    // ============================================================
    // í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹°
    // ============================================================

    let testResults = [];

    function log(message, type = 'info') {
      const resultsDiv = document.getElementById('testResults');
      const resultDiv = document.createElement('div');
      resultDiv.className = `result ${type}`;
      resultDiv.textContent = message;
      resultsDiv.appendChild(resultDiv);
      testResults.push({ message, type });
    }

    function logSeparator() {
      const resultsDiv = document.getElementById('testResults');
      const div = document.createElement('div');
      div.className = 'result separator';
      resultsDiv.appendChild(div);
    }

    function clearResults() {
      document.getElementById('testResults').innerHTML = '';
      document.getElementById('summaryBar').innerHTML = '';
      document.getElementById('stats').innerHTML = '';
      testResults = [];
    }

    function waitFor(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    /** DOM Fixtureë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ë¦¬ì…‹ */
    function resetFixture() {
      localStorage.removeItem('lotto_history');
      document.getElementById('setsContainer').innerHTML = '';
      document.getElementById('historyList').innerHTML = '';
      document.getElementById('historyList').classList.add('hidden');
      document.getElementById('historyToggleText').textContent = 'ì´ë ¥ ë³´ê¸° â–¼';
      document.getElementById('setCount').value = '1';
      document.getElementById('excludeGrid').innerHTML = '';
      document.getElementById('excludePanel').classList.add('hidden');
      document.getElementById('excludeToggleText').textContent = 'ë²ˆí˜¸ ì œì™¸ ì„¤ì • â–¼';
      document.getElementById('excludeCount').textContent = 'ì œì™¸: 0ê°œ';
      document.getElementById('remainCount').textContent = 'ë‚¨ì€ ë²ˆí˜¸: 45ê°œ';
      document.getElementById('excludeWarning').classList.add('hidden');
      document.querySelectorAll('.toast').forEach(t => t.remove());
    }

    function showSummary() {
      const passCount = testResults.filter(r => r.type === 'pass').length;
      const failCount = testResults.filter(r => r.type === 'fail').length;
      const total = passCount + failCount;
      const allPass = failCount === 0;

      log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
      log(`í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${passCount} í†µê³¼ / ${failCount} ì‹¤íŒ¨ (ì´ ${total}ê°œ ê²€ì¦)`,
        allPass ? 'pass' : 'fail');

      const bar = document.getElementById('summaryBar');
      bar.className = `summary-bar ${allPass ? 'all-pass' : 'has-fail'}`;
      bar.innerHTML = `
        <span>${allPass ? 'âœ…' : 'âŒ'} ${passCount} í†µê³¼</span>
        <span>${failCount > 0 ? 'âŒ ' + failCount + ' ì‹¤íŒ¨' : ''}</span>
        <span>ì´ ${total}ê°œ ê²€ì¦</span>
      `;
    }

    // ============================================================
    // A. í•µì‹¬ ìƒì„± ë¡œì§ (ì‹¤ì œ generateSingleSet ì‚¬ìš©)
    // ============================================================

    function testBasicGeneration() {
      log('â•â•â• Test 1: generateSingleSet() ê¸°ë³¸ ë™ì‘ â•â•â•', 'info');

      const numbers = generateSingleSet();

      if (numbers.length === 6) {
        log('âœ… PASS: 6ê°œì˜ ìˆ«ì ìƒì„±ë¨', 'pass');
      } else {
        log(`âŒ FAIL: ${numbers.length}ê°œ ìƒì„±ë¨ (ì˜ˆìƒ: 6ê°œ)`, 'fail');
      }

      if (Array.isArray(numbers)) {
        log('âœ… PASS: ë°°ì—´ íƒ€ì… ë°˜í™˜', 'pass');
      } else {
        log('âŒ FAIL: ë°°ì—´ì´ ì•„ë‹Œ íƒ€ì… ë°˜í™˜', 'fail');
      }

      const allIntegers = numbers.every(n => Number.isInteger(n));
      if (allIntegers) {
        log('âœ… PASS: ëª¨ë“  ìš”ì†Œê°€ ì •ìˆ˜', 'pass');
      } else {
        log('âŒ FAIL: ì •ìˆ˜ê°€ ì•„ë‹Œ ìš”ì†Œ ì¡´ì¬', 'fail');
      }

      log(`ìƒì„±ëœ ìˆ«ì: [${numbers.join(', ')}]`, 'info');
    }

    function testNumberRange() {
      log('â•â•â• Test 2: ìˆ«ì ë²”ìœ„ ê²€ì¦ (1-45, 100íšŒ) â•â•â•', 'info');

      let passCount = 0;
      const iterations = 100;

      for (let i = 0; i < iterations; i++) {
        const numbers = generateSingleSet();
        if (numbers.every(n => n >= 1 && n <= 45)) passCount++;
      }

      if (passCount === iterations) {
        log(`âœ… PASS: ${iterations}íšŒ ëª¨ë‘ 1-45 ë²”ìœ„ ë‚´`, 'pass');
      } else {
        log(`âŒ FAIL: ${passCount}/${iterations} í†µê³¼`, 'fail');
      }
    }

    function testNoDuplicates() {
      log('â•â•â• Test 3: ì¤‘ë³µ ê²€ì¦ (100íšŒ) â•â•â•', 'info');

      let passCount = 0;
      const iterations = 100;

      for (let i = 0; i < iterations; i++) {
        const numbers = generateSingleSet();
        if (new Set(numbers).size === 6) passCount++;
      }

      if (passCount === iterations) {
        log(`âœ… PASS: ${iterations}íšŒ ëª¨ë‘ ì¤‘ë³µ ì—†ìŒ`, 'pass');
      } else {
        log(`âŒ FAIL: ${passCount}/${iterations} í†µê³¼`, 'fail');
      }
    }

    function testSorting() {
      log('â•â•â• Test 4: ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬ ê²€ì¦ (100íšŒ) â•â•â•', 'info');

      let passCount = 0;
      const iterations = 100;

      for (let i = 0; i < iterations; i++) {
        const numbers = generateSingleSet();
        const isSorted = numbers.every((n, idx, arr) => idx === 0 || arr[idx - 1] < n);
        if (isSorted) passCount++;
      }

      if (passCount === iterations) {
        log(`âœ… PASS: ${iterations}íšŒ ëª¨ë‘ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬`, 'pass');
      } else {
        log(`âŒ FAIL: ${passCount}/${iterations} í†µê³¼`, 'fail');
      }
    }

    function testRandomness() {
      log('â•â•â• Test 5: ëœë¤ì„± ê²€ì¦ (100íšŒ) â•â•â•', 'info');

      const iterations = 100;
      const results = [];

      for (let i = 0; i < iterations; i++) {
        results.push(generateSingleSet().join(','));
      }

      const uniqueCombinations = new Set(results).size;
      const pct = (uniqueCombinations / iterations * 100).toFixed(1);

      log(`ê³ ìœ  ì¡°í•©: ${uniqueCombinations}/${iterations}ê°œ (${pct}%)`, 'info');

      if (pct >= 90) {
        log(`âœ… PASS: ëœë¤ì„± ì–‘í˜¸ (${pct}% ê³ ìœ )`, 'pass');
      } else {
        log(`âŒ FAIL: ëœë¤ì„± ë¶€ì¡± (${pct}% ê³ ìœ )`, 'fail');
      }
    }

    function testDistribution() {
      log('â•â•â• Test 6: ìˆ«ì ë¶„í¬ ê· ë“±ì„± (1000íšŒ) â•â•â•', 'info');

      const iterations = 1000;
      const frequency = new Array(46).fill(0);

      for (let i = 0; i < iterations; i++) {
        generateSingleSet().forEach(n => frequency[n]++);
      }

      const counts = frequency.slice(1);
      const total = counts.reduce((a, b) => a + b, 0);
      const average = total / 45;
      const variance = counts.reduce((sum, c) => sum + Math.pow(c - average, 2), 0) / 45;
      const stdDev = Math.sqrt(variance);

      const maxCount = Math.max(...counts);
      const minCount = Math.min(...counts);

      log(`í‰ê· : ${average.toFixed(1)}, í‘œì¤€í¸ì°¨: ${stdDev.toFixed(2)}, ìµœëŒ€: ${maxCount}, ìµœì†Œ: ${minCount}`, 'info');

      const threshold = average * 0.3;
      if (stdDev <= threshold) {
        log(`âœ… PASS: ë¶„í¬ ê· ë“± (í‘œì¤€í¸ì°¨ ${stdDev.toFixed(2)} <= ${threshold.toFixed(2)})`, 'pass');
      } else {
        log(`âŒ FAIL: ë¶„í¬ ë¶ˆê· ë“± (í‘œì¤€í¸ì°¨ ${stdDev.toFixed(2)} > ${threshold.toFixed(2)})`, 'fail');
      }

      // í†µê³„ ì¹´ë“œ í‘œì‹œ
      const statsDiv = document.getElementById('stats');
      statsDiv.innerHTML = `
        <div class="stat-card">
          <div class="stat-label">ì´ ì¶”ì²¨</div>
          <div class="stat-value">${iterations}íšŒ</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">í‰ê·  ì¶œí˜„</div>
          <div class="stat-value">${average.toFixed(1)}íšŒ</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ìµœëŒ€ ì¶œí˜„</div>
          <div class="stat-value">${maxCount}íšŒ</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ìµœì†Œ ì¶œí˜„</div>
          <div class="stat-value">${minCount}íšŒ</div>
        </div>
      `;
    }

    // ============================================================
    // B. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    // ============================================================

    function testGenerateUUID() {
      log('â•â•â• Test 7: generateUUID() í˜•ì‹ ë° ìœ ì¼ì„± â•â•â•', 'info');

      const uuid = generateUUID();
      const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/;

      if (uuidRegex.test(uuid)) {
        log('âœ… PASS: UUID v4 í˜•ì‹ ì¼ì¹˜', 'pass');
      } else {
        log(`âŒ FAIL: UUID í˜•ì‹ ë¶ˆì¼ì¹˜ ("${uuid}")`, 'fail');
      }

      // 100ê°œ ìƒì„± í›„ ìœ ì¼ì„± í™•ì¸
      const uuids = new Set();
      for (let i = 0; i < 100; i++) {
        uuids.add(generateUUID());
      }

      if (uuids.size === 100) {
        log('âœ… PASS: 100ê°œ UUID ëª¨ë‘ ê³ ìœ ', 'pass');
      } else {
        log(`âŒ FAIL: 100ê°œ ì¤‘ ${uuids.size}ê°œë§Œ ê³ ìœ `, 'fail');
      }
    }

    // ============================================================
    // C. ì´ë ¥ ê´€ë¦¬ (F-003)
    // ============================================================

    function testHistorySave() {
      log('â•â•â• Test 8: saveToHistory() ì €ì¥ â•â•â•', 'info');
      resetFixture();

      const testNumbers = [3, 12, 19, 27, 38, 42];
      saveToHistory(testNumbers);

      const saved = JSON.parse(localStorage.getItem('lotto_history'));

      if (saved && saved.version === '1.0') {
        log('âœ… PASS: version "1.0" ì €ì¥', 'pass');
      } else {
        log('âŒ FAIL: version ëˆ„ë½ ë˜ëŠ” ë¶ˆì¼ì¹˜', 'fail');
      }

      if (saved && saved.history && saved.history.length === 1) {
        log('âœ… PASS: ì´ë ¥ 1ê°œ ì €ì¥', 'pass');
      } else {
        log(`âŒ FAIL: ì´ë ¥ ê°œìˆ˜ ì˜¤ë¥˜ (${saved?.history?.length})`, 'fail');
      }

      const item = saved.history[0];

      if (item.numbers.join(',') === testNumbers.join(',')) {
        log('âœ… PASS: ìˆ«ì ë°°ì—´ ì¼ì¹˜', 'pass');
      } else {
        log('âŒ FAIL: ìˆ«ì ë°°ì—´ ë¶ˆì¼ì¹˜', 'fail');
      }

      if (item.id && typeof item.id === 'string' && item.id.length > 0) {
        log('âœ… PASS: id ìë™ ìƒì„±', 'pass');
      } else {
        log('âŒ FAIL: id ëˆ„ë½', 'fail');
      }

      if (item.timestamp && !isNaN(new Date(item.timestamp).getTime())) {
        log('âœ… PASS: timestamp ISO 8601 í˜•ì‹', 'pass');
      } else {
        log('âŒ FAIL: timestamp í˜•ì‹ ì˜¤ë¥˜', 'fail');
      }

      if (item.setCount === 1) {
        log('âœ… PASS: setCount ê¸°ë³¸ê°’ 1', 'pass');
      } else {
        log(`âŒ FAIL: setCount ê¸°ë³¸ê°’ ì˜¤ë¥˜ (${item.setCount})`, 'fail');
      }
    }

    function testHistoryLoad() {
      log('â•â•â• Test 9: loadHistory() ë¡œë“œ ë° ì˜ˆì™¸ì²˜ë¦¬ â•â•â•', 'info');
      resetFixture();

      // ì •ìƒ ë°ì´í„° ë¡œë“œ
      const testData = {
        version: '1.0',
        history: [
          { id: 'test-1', numbers: [1, 2, 3, 4, 5, 6], timestamp: '2026-02-11T10:00:00.000Z', setCount: 1 },
          { id: 'test-2', numbers: [7, 8, 9, 10, 11, 12], timestamp: '2026-02-11T09:00:00.000Z', setCount: 1 }
        ]
      };
      localStorage.setItem('lotto_history', JSON.stringify(testData));

      const loaded = loadHistory();

      if (loaded.length === 2) {
        log('âœ… PASS: ì´ë ¥ 2ê°œ ë¡œë“œ', 'pass');
      } else {
        log(`âŒ FAIL: ë¡œë“œ ê°œìˆ˜ ì˜¤ë¥˜ (${loaded.length})`, 'fail');
      }

      if (loaded[0].id === 'test-1' && loaded[1].id === 'test-2') {
        log('âœ… PASS: ì´ë ¥ ìˆœì„œ ìœ ì§€', 'pass');
      } else {
        log('âŒ FAIL: ì´ë ¥ ìˆœì„œ ì˜¤ë¥˜', 'fail');
      }

      // ì˜ëª»ëœ JSON
      localStorage.setItem('lotto_history', 'not valid json {{{');
      if (loadHistory().length === 0) {
        log('âœ… PASS: ì˜ëª»ëœ JSON -> ë¹ˆ ë°°ì—´', 'pass');
      } else {
        log('âŒ FAIL: ì˜ëª»ëœ JSON ì˜ˆì™¸ì²˜ë¦¬ ì‹¤íŒ¨', 'fail');
      }

      // ì˜ëª»ëœ ë²„ì „
      localStorage.setItem('lotto_history', JSON.stringify({ version: '999.0', history: [{}] }));
      if (loadHistory().length === 0) {
        log('âœ… PASS: ë¯¸ì§€ì› ë²„ì „ -> ë¹ˆ ë°°ì—´', 'pass');
      } else {
        log('âŒ FAIL: ë²„ì „ ê²€ì¦ ì‹¤íŒ¨', 'fail');
      }

      // ë¹ˆ LocalStorage
      localStorage.removeItem('lotto_history');
      if (loadHistory().length === 0) {
        log('âœ… PASS: ë¹ˆ ì €ì¥ì†Œ -> ë¹ˆ ë°°ì—´', 'pass');
      } else {
        log('âŒ FAIL: ë¹ˆ ì €ì¥ì†Œ ì²˜ë¦¬ ì‹¤íŒ¨', 'fail');
      }
    }

    function testHistoryMaxLimit() {
      log('â•â•â• Test 10: ì´ë ¥ ìµœëŒ€ 20ê°œ ì œí•œ â•â•â•', 'info');
      resetFixture();

      // 25ê°œ ì €ì¥
      for (let i = 0; i < 25; i++) {
        saveToHistory(generateSingleSet());
      }

      const history = loadHistory();

      if (history.length === 20) {
        log('âœ… PASS: ìµœëŒ€ 20ê°œ ì œí•œ', 'pass');
      } else {
        log(`âŒ FAIL: ${history.length}ê°œ ì €ì¥ë¨`, 'fail');
      }

      // ìµœì‹ ìˆœ ì •ë ¬ í™•ì¸
      const timestamps = history.map(h => new Date(h.timestamp).getTime());
      const isSorted = timestamps.every((t, i, arr) => i === 0 || arr[i - 1] >= t);

      if (isSorted) {
        log('âœ… PASS: ìµœì‹ ìˆœ ì •ë ¬ ìœ ì§€', 'pass');
      } else {
        log('âŒ FAIL: ì •ë ¬ ìˆœì„œ ì˜¤ë¥˜', 'fail');
      }
    }

    function testClearHistory() {
      log('â•â•â• Test 11: clearHistory() ì‹¤ì œ í•¨ìˆ˜ í˜¸ì¶œ â•â•â•', 'info');
      resetFixture();

      // confirm/alert ëª¨í‚¹
      const origConfirm = window.confirm;
      const origAlert = window.alert;
      let alertMsg = '';

      // Case 1: ë¹ˆ ì´ë ¥ì—ì„œ ì‚­ì œ ì‹œë„
      window.alert = (msg) => { alertMsg = msg; };
      window.confirm = () => true;
      clearHistory();

      if (alertMsg === 'ì‚­ì œí•  ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.') {
        log('âœ… PASS: ë¹ˆ ì´ë ¥ ì‚­ì œ ì‹œ ê²½ê³  ë©”ì‹œì§€', 'pass');
      } else {
        log(`âŒ FAIL: ë¹ˆ ì´ë ¥ ê²½ê³  ë¯¸í‘œì‹œ ("${alertMsg}")`, 'fail');
      }

      // Case 2: confirm ìŠ¹ì¸ ì‹œ ì‚­ì œ
      saveToHistory([1, 2, 3, 4, 5, 6]);
      alertMsg = '';
      window.confirm = () => true;
      window.alert = (msg) => { alertMsg = msg; };
      clearHistory();

      if (loadHistory().length === 0) {
        log('âœ… PASS: confirm ìŠ¹ì¸ -> ì´ë ¥ ì‚­ì œ', 'pass');
      } else {
        log('âŒ FAIL: ì´ë ¥ ì‚­ì œ ì‹¤íŒ¨', 'fail');
      }

      if (alertMsg === 'ì´ë ¥ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.') {
        log('âœ… PASS: ì‚­ì œ ì™„ë£Œ ì•Œë¦¼ ë©”ì‹œì§€', 'pass');
      } else {
        log(`âŒ FAIL: ì™„ë£Œ ë©”ì‹œì§€ ì˜¤ë¥˜ ("${alertMsg}")`, 'fail');
      }

      // Case 3: confirm ê±°ë¶€ ì‹œ ìœ ì§€
      saveToHistory([7, 8, 9, 10, 11, 12]);
      window.confirm = () => false;
      window.alert = () => {};
      clearHistory();

      if (loadHistory().length === 1) {
        log('âœ… PASS: confirm ê±°ë¶€ -> ì´ë ¥ ìœ ì§€', 'pass');
      } else {
        log('âŒ FAIL: confirm ê±°ë¶€ í›„ ì´ë ¥ ë³€ê²½ë¨', 'fail');
      }

      // ë³µì›
      window.confirm = origConfirm;
      window.alert = origAlert;
    }

    function testSetCountInHistory() {
      log('â•â•â• Test 12: setCount ì´ë ¥ ì €ì¥ â•â•â•', 'info');
      resetFixture();

      saveToHistory([1, 2, 3, 4, 5, 6], 3);
      const history = loadHistory();

      if (history[0].setCount === 3) {
        log('âœ… PASS: setCount=3 ì €ì¥', 'pass');
      } else {
        log(`âŒ FAIL: setCount ì˜¤ë¥˜ (${history[0].setCount})`, 'fail');
      }

      saveToHistory([7, 8, 9, 10, 11, 12]);
      const history2 = loadHistory();

      if (history2[0].setCount === 1) {
        log('âœ… PASS: setCount ê¸°ë³¸ê°’=1', 'pass');
      } else {
        log(`âŒ FAIL: setCount ê¸°ë³¸ê°’ ì˜¤ë¥˜ (${history2[0].setCount})`, 'fail');
      }
    }

    // ============================================================
    // D. ì—¬ëŸ¬ ì„¸íŠ¸ ë™ì‹œ ì¶”ì²¨ (F-004)
    // ============================================================

    function testMultipleSets() {
      log('â•â•â• Test 13: generateMultipleSets() ê¸°ë³¸ ë™ì‘ â•â•â•', 'info');

      const sets = generateMultipleSets(3);

      if (sets.length === 3) {
        log('âœ… PASS: 3ê°œ ì„¸íŠ¸ ìƒì„±', 'pass');
      } else {
        log(`âŒ FAIL: ${sets.length}ê°œ ì„¸íŠ¸`, 'fail');
      }

      if (sets.every(set => set.length === 6)) {
        log('âœ… PASS: ëª¨ë“  ì„¸íŠ¸ 6ê°œ ìˆ«ì', 'pass');
      } else {
        log('âŒ FAIL: ì„¸íŠ¸ ë‚´ ìˆ«ì ê°œìˆ˜ ì˜¤ë¥˜', 'fail');
      }

      if (sets.every(set => set.every((n, i, arr) => i === 0 || arr[i - 1] < n))) {
        log('âœ… PASS: ëª¨ë“  ì„¸íŠ¸ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬', 'pass');
      } else {
        log('âŒ FAIL: ì •ë ¬ ì˜¤ë¥˜', 'fail');
      }

      if (sets.every(set => new Set(set).size === 6)) {
        log('âœ… PASS: ê° ì„¸íŠ¸ ë‚´ ì¤‘ë³µ ì—†ìŒ', 'pass');
      } else {
        log('âŒ FAIL: ì„¸íŠ¸ ë‚´ ì¤‘ë³µ ë°œê²¬', 'fail');
      }
    }

    function testMultipleSetsBoundary() {
      log('â•â•â• Test 14: generateMultipleSets() ê²½ê³„ê°’ (1, 5) â•â•â•', 'info');

      // ìµœì†Œ: 1ê°œ
      const single = generateMultipleSets(1);
      if (single.length === 1 && single[0].length === 6) {
        log('âœ… PASS: 1ì„¸íŠ¸ ìƒì„± ì •ìƒ', 'pass');
      } else {
        log('âŒ FAIL: 1ì„¸íŠ¸ ìƒì„± ì˜¤ë¥˜', 'fail');
      }

      // ìµœëŒ€: 5ê°œ
      const five = generateMultipleSets(5);
      if (five.length === 5 && five.every(s => s.length === 6)) {
        log('âœ… PASS: 5ì„¸íŠ¸ ìƒì„± ì •ìƒ', 'pass');
      } else {
        log('âŒ FAIL: 5ì„¸íŠ¸ ìƒì„± ì˜¤ë¥˜', 'fail');
      }

      // ê° ì„¸íŠ¸ê°€ ë…ë¦½ì ì¸ì§€ (100íšŒ ì¤‘ ìµœì†Œ 1íšŒëŠ” ë‹¤ë¥¸ ì¡°í•©)
      const results = [];
      for (let i = 0; i < 20; i++) {
        const sets = generateMultipleSets(2);
        results.push(sets[0].join(',') !== sets[1].join(','));
      }
      const hasDifferent = results.some(r => r);

      if (hasDifferent) {
        log('âœ… PASS: ì„¸íŠ¸ ê°„ ë…ë¦½ì  ì¶”ì²¨ í™•ì¸', 'pass');
      } else {
        log('âŒ FAIL: 20íšŒ ì¤‘ ëª¨ë“  ì„¸íŠ¸ê°€ ë™ì¼ (ë…ë¦½ì„± ì˜ì‹¬)', 'fail');
      }
    }

    function testGetSelectedSetCount() {
      log('â•â•â• Test 15: getSelectedSetCount() DOM ì—°ë™ â•â•â•', 'info');

      const select = document.getElementById('setCount');

      // ê¸°ë³¸ê°’ (1)
      select.value = '1';
      if (getSelectedSetCount() === 1) {
        log('âœ… PASS: ê¸°ë³¸ê°’ 1 ë°˜í™˜', 'pass');
      } else {
        log(`âŒ FAIL: ê¸°ë³¸ê°’ ì˜¤ë¥˜ (${getSelectedSetCount()})`, 'fail');
      }

      // ìµœëŒ€ê°’ (5)
      select.value = '5';
      if (getSelectedSetCount() === 5) {
        log('âœ… PASS: ìµœëŒ€ê°’ 5 ë°˜í™˜', 'pass');
      } else {
        log(`âŒ FAIL: ìµœëŒ€ê°’ ì˜¤ë¥˜ (${getSelectedSetCount()})`, 'fail');
      }

      // ë°˜í™˜ íƒ€ì…ì´ numberì¸ì§€ í™•ì¸
      select.value = '3';
      if (typeof getSelectedSetCount() === 'number') {
        log('âœ… PASS: number íƒ€ì… ë°˜í™˜', 'pass');
      } else {
        log(`âŒ FAIL: ë°˜í™˜ íƒ€ì… ì˜¤ë¥˜ (${typeof getSelectedSetCount()})`, 'fail');
      }

      select.value = '1'; // ë³µì›
    }

    // ============================================================
    // E. ë³µì‚¬ ë° í† ìŠ¤íŠ¸ (F-006)
    // ============================================================

    async function testCopyFunction() {
      log('â•â•â• Test 16: copyToClipboard() â•â•â•', 'info');

      const testNumbers = [3, 12, 19, 27, 38, 42];

      // Clipboard API ì§€ì› í™•ì¸
      if (!navigator.clipboard || !navigator.clipboard.writeText) {
        log('âš ï¸ INFO: Clipboard API ë¯¸ì§€ì› (HTTPS í•„ìš”) - ìŠ¤í‚µ', 'info');

        // ë¯¸ì§€ì› ì‹œ ì—ëŸ¬ ì²˜ë¦¬ ê²€ì¦
        const result = await copyToClipboard(testNumbers);
        if (result === false) {
          log('âœ… PASS: ë¯¸ì§€ì› ì‹œ false ë°˜í™˜', 'pass');
        } else {
          log('âŒ FAIL: ë¯¸ì§€ì› ì‹œ ë°˜í™˜ê°’ ì˜¤ë¥˜', 'fail');
        }
        return;
      }

      try {
        const result = await copyToClipboard(testNumbers);

        if (result === true) {
          log('âœ… PASS: ë³µì‚¬ ì„±ê³µ (true ë°˜í™˜)', 'pass');
        } else {
          log('âŒ FAIL: ë³µì‚¬ ì‹¤íŒ¨', 'fail');
        }

        // í´ë¦½ë³´ë“œ ë‚´ìš© ê²€ì¦
        const clipText = await navigator.clipboard.readText();
        if (clipText === '3, 12, 19, 27, 38, 42') {
          log('âœ… PASS: í´ë¦½ë³´ë“œ ë‚´ìš© ì¼ì¹˜', 'pass');
        } else {
          log(`âŒ FAIL: í´ë¦½ë³´ë“œ ë‚´ìš© ë¶ˆì¼ì¹˜ ("${clipText}")`, 'fail');
        }

        // setNumber íŒŒë¼ë¯¸í„° í…ŒìŠ¤íŠ¸
        await copyToClipboard(testNumbers, 2);
        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ì— "2íšŒì°¨" í¬í•¨ í™•ì¸
        await waitFor(50);
        const toast = document.querySelector('.toast');
        if (toast && toast.textContent.includes('2íšŒì°¨')) {
          log('âœ… PASS: setNumber ë°˜ì˜ëœ í† ìŠ¤íŠ¸ ë©”ì‹œì§€', 'pass');
        } else {
          log('âŒ FAIL: setNumber ë¯¸ë°˜ì˜', 'fail');
        }
      } catch (error) {
        log(`âš ï¸ INFO: ë³µì‚¬ í…ŒìŠ¤íŠ¸ ì œí•œ (${error.message})`, 'info');
      }

      // í† ìŠ¤íŠ¸ ì •ë¦¬
      document.querySelectorAll('.toast').forEach(t => t.remove());
    }

    async function testToastFunction() {
      log('â•â•â• Test 17: showToast() ë™ì‘ â•â•â•', 'info');

      document.querySelectorAll('.toast').forEach(t => t.remove());

      // success íƒ€ì… í…ŒìŠ¤íŠ¸
      showToast('ì„±ê³µ ë©”ì‹œì§€', 'success', 500);
      await waitFor(50);

      let toast = document.querySelector('.toast');
      if (toast) {
        log('âœ… PASS: í† ìŠ¤íŠ¸ DOM ìƒì„±', 'pass');
      } else {
        log('âŒ FAIL: í† ìŠ¤íŠ¸ DOM ë¯¸ìƒì„±', 'fail');
        return;
      }

      if (toast.classList.contains('success')) {
        log('âœ… PASS: success í´ë˜ìŠ¤ ì ìš©', 'pass');
      } else {
        log('âŒ FAIL: success í´ë˜ìŠ¤ ë¯¸ì ìš©', 'fail');
      }

      if (toast.textContent === 'ì„±ê³µ ë©”ì‹œì§€') {
        log('âœ… PASS: ë©”ì‹œì§€ ë‚´ìš© ì¼ì¹˜', 'pass');
      } else {
        log(`âŒ FAIL: ë©”ì‹œì§€ ë¶ˆì¼ì¹˜ ("${toast.textContent}")`, 'fail');
      }

      // ìë™ ì œê±° í™•ì¸ (500ms duration + 300ms animation)
      await waitFor(1000);

      if (!document.querySelector('.toast')) {
        log('âœ… PASS: í† ìŠ¤íŠ¸ ìë™ ì œê±°', 'pass');
      } else {
        log('âŒ FAIL: í† ìŠ¤íŠ¸ ìë™ ì œê±° ì‹¤íŒ¨', 'fail');
      }

      // error íƒ€ì… í…ŒìŠ¤íŠ¸
      showToast('ì—ëŸ¬ ë©”ì‹œì§€', 'error', 500);
      await waitFor(50);

      toast = document.querySelector('.toast');
      if (toast && toast.classList.contains('error')) {
        log('âœ… PASS: error í´ë˜ìŠ¤ ì ìš©', 'pass');
      } else {
        log('âŒ FAIL: error í´ë˜ìŠ¤ ë¯¸ì ìš©', 'fail');
      }

      // ì—°ì† í˜¸ì¶œ ì‹œ ê¸°ì¡´ í† ìŠ¤íŠ¸ êµì²´
      showToast('ì²« ë²ˆì§¸', 'success', 2000);
      showToast('ë‘ ë²ˆì§¸', 'success', 500);
      await waitFor(50);

      const toasts = document.querySelectorAll('.toast');
      if (toasts.length === 1 && toasts[0].textContent === 'ë‘ ë²ˆì§¸') {
        log('âœ… PASS: ì—°ì† í˜¸ì¶œ ì‹œ êµì²´ ì •ìƒ', 'pass');
      } else {
        log(`âŒ FAIL: í† ìŠ¤íŠ¸ êµì²´ ì˜¤ë¥˜ (${toasts.length}ê°œ ì¡´ì¬)`, 'fail');
      }

      // ì •ë¦¬ ëŒ€ê¸°
      await waitFor(1000);
      document.querySelectorAll('.toast').forEach(t => t.remove());
    }

    // ============================================================
    // F. DOM ë Œë”ë§
    // ============================================================

    function testDisplayMultipleSets() {
      log('â•â•â• Test 18: displayMultipleSets() DOM ë Œë”ë§ â•â•â•', 'info');
      resetFixture();

      const testSets = [[1, 5, 12, 23, 34, 45], [2, 10, 20, 30, 40, 44]];
      displayMultipleSets(testSets);

      const container = document.getElementById('setsContainer');
      const cards = container.querySelectorAll('.set-card');

      // ì¹´ë“œ ìˆ˜
      if (cards.length === 2) {
        log('âœ… PASS: 2ê°œ ì„¸íŠ¸ ì¹´ë“œ ìƒì„±', 'pass');
      } else {
        log(`âŒ FAIL: ${cards.length}ê°œ ì¹´ë“œ (ì˜ˆìƒ: 2)`, 'fail');
      }

      // ë¼ë²¨
      const labels = container.querySelectorAll('.set-label');
      if (labels[0].textContent === '1íšŒì°¨' && labels[1].textContent === '2íšŒì°¨') {
        log('âœ… PASS: ì„¸íŠ¸ ë¼ë²¨ ("1íšŒì°¨", "2íšŒì°¨")', 'pass');
      } else {
        log('âŒ FAIL: ì„¸íŠ¸ ë¼ë²¨ ì˜¤ë¥˜', 'fail');
      }

      // ìˆ«ì ë±ƒì§€
      const firstNumbers = cards[0].querySelectorAll('.number');
      if (firstNumbers.length === 6) {
        log('âœ… PASS: ì²« ë²ˆì§¸ ì¹´ë“œ 6ê°œ ìˆ«ì ë±ƒì§€', 'pass');
      } else {
        log(`âŒ FAIL: ${firstNumbers.length}ê°œ ë±ƒì§€`, 'fail');
      }

      // textContent ì‚¬ìš© í™•ì¸ (XSS ì•ˆì „)
      if (firstNumbers[0].textContent === '1' && firstNumbers[5].textContent === '45') {
        log('âœ… PASS: textContentë¡œ ìˆ«ì ì„¤ì • (XSS ì•ˆì „)', 'pass');
      } else {
        log('âŒ FAIL: ìˆ«ì í‘œì‹œ ì˜¤ë¥˜', 'fail');
      }

      // ë³µì‚¬ ë²„íŠ¼
      const copyBtns = container.querySelectorAll('.copy-btn');
      if (copyBtns.length === 2) {
        log('âœ… PASS: ê° ì¹´ë“œì— ë³µì‚¬ ë²„íŠ¼', 'pass');
      } else {
        log(`âŒ FAIL: ë³µì‚¬ ë²„íŠ¼ ${copyBtns.length}ê°œ`, 'fail');
      }

      // ì¬í˜¸ì¶œ ì‹œ ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™” í™•ì¸
      displayMultipleSets([[1, 2, 3, 4, 5, 6]]);
      if (container.querySelectorAll('.set-card').length === 1) {
        log('âœ… PASS: ì¬í˜¸ì¶œ ì‹œ ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”', 'pass');
      } else {
        log('âŒ FAIL: ê¸°ì¡´ ë‚´ìš© ë¯¸ì´ˆê¸°í™”', 'fail');
      }
    }

    function testDisplayHistory() {
      log('â•â•â• Test 19: displayHistory() DOM ë Œë”ë§ â•â•â•', 'info');
      resetFixture();

      const historyList = document.getElementById('historyList');
      historyList.classList.remove('hidden');

      // ë¹ˆ ì´ë ¥ í‘œì‹œ
      displayHistory();
      const emptyMsg = historyList.querySelector('.history-empty');
      if (emptyMsg && emptyMsg.textContent === 'ì•„ì§ ì¶”ì²¨ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.') {
        log('âœ… PASS: ë¹ˆ ì´ë ¥ ë©”ì‹œì§€ í‘œì‹œ', 'pass');
      } else {
        log('âŒ FAIL: ë¹ˆ ì´ë ¥ ë©”ì‹œì§€ ë¯¸í‘œì‹œ', 'fail');
      }

      // ì´ë ¥ ì €ì¥ í›„ í‘œì‹œ
      const testData = {
        version: '1.0',
        history: [
          { id: 'h-1', numbers: [3, 12, 19, 27, 38, 42], timestamp: '2026-02-11T10:30:00.000Z', setCount: 1 },
          { id: 'h-2', numbers: [5, 15, 25, 35, 40, 45], timestamp: '2026-02-11T09:00:00.000Z', setCount: 3 }
        ]
      };
      localStorage.setItem('lotto_history', JSON.stringify(testData));
      displayHistory();

      const items = historyList.querySelectorAll('.history-item');
      if (items.length === 2) {
        log('âœ… PASS: ì´ë ¥ 2ê°œ í•­ëª© ë Œë”ë§', 'pass');
      } else {
        log(`âŒ FAIL: ${items.length}ê°œ ë Œë”ë§`, 'fail');
      }

      // ìˆ«ì í‘œì‹œ í™•ì¸
      const numbersText = items[0].querySelector('.history-numbers').textContent;
      if (numbersText === '3, 12, 19, 27, 38, 42') {
        log('âœ… PASS: ìˆ«ì í‘œì‹œ ì •ìƒ', 'pass');
      } else {
        log(`âŒ FAIL: ìˆ«ì í‘œì‹œ ì˜¤ë¥˜ ("${numbersText}")`, 'fail');
      }

      // ì‹œê°„ í‘œì‹œ í™•ì¸
      const timeText = items[0].querySelector('.history-time').textContent;
      if (timeText.includes('2026')) {
        log('âœ… PASS: ì‹œê°„ í¬ë§· í¬í•¨ (ì—°ë„)', 'pass');
      } else {
        log(`âŒ FAIL: ì‹œê°„ í¬ë§· ì˜¤ë¥˜ ("${timeText}")`, 'fail');
      }

      // setCount > 1ì¼ ë•Œ "Nì„¸íŠ¸ ì¤‘" í‘œì‹œ
      const timeText2 = items[1].querySelector('.history-time').textContent;
      if (timeText2.includes('3ì„¸íŠ¸ ì¤‘')) {
        log('âœ… PASS: setCount í‘œì‹œ ("3ì„¸íŠ¸ ì¤‘")', 'pass');
      } else {
        log(`âŒ FAIL: setCount ë¯¸í‘œì‹œ ("${timeText2}")`, 'fail');
      }
    }

    function testToggleHistoryView() {
      log('â•â•â• Test 20: toggleHistoryView() í† ê¸€ ë™ì‘ â•â•â•', 'info');
      resetFixture();

      const historyList = document.getElementById('historyList');
      const toggleText = document.getElementById('historyToggleText');

      // ì´ˆê¸° ìƒíƒœ: hidden
      if (historyList.classList.contains('hidden')) {
        log('âœ… PASS: ì´ˆê¸° ìƒíƒœ hidden', 'pass');
      } else {
        log('âŒ FAIL: ì´ˆê¸° ìƒíƒœ ë¯¸hidden', 'fail');
      }

      if (toggleText.textContent === 'ì´ë ¥ ë³´ê¸° â–¼') {
        log('âœ… PASS: ì´ˆê¸° ë²„íŠ¼ í…ìŠ¤íŠ¸ "ì´ë ¥ ë³´ê¸° â–¼"', 'pass');
      } else {
        log(`âŒ FAIL: ì´ˆê¸° í…ìŠ¤íŠ¸ ì˜¤ë¥˜ ("${toggleText.textContent}")`, 'fail');
      }

      // í† ê¸€ 1íšŒ: ì—´ê¸°
      toggleHistoryView();

      if (!historyList.classList.contains('hidden')) {
        log('âœ… PASS: í† ê¸€ í›„ í‘œì‹œ (hidden ì œê±°)', 'pass');
      } else {
        log('âŒ FAIL: í† ê¸€ í›„ì—ë„ hidden', 'fail');
      }

      if (toggleText.textContent === 'ì´ë ¥ ìˆ¨ê¸°ê¸° â–²') {
        log('âœ… PASS: í† ê¸€ í›„ í…ìŠ¤íŠ¸ "ì´ë ¥ ìˆ¨ê¸°ê¸° â–²"', 'pass');
      } else {
        log(`âŒ FAIL: í† ê¸€ í›„ í…ìŠ¤íŠ¸ ì˜¤ë¥˜ ("${toggleText.textContent}")`, 'fail');
      }

      // í† ê¸€ 2íšŒ: ë‹«ê¸°
      toggleHistoryView();

      if (historyList.classList.contains('hidden')) {
        log('âœ… PASS: ì¬í† ê¸€ í›„ ìˆ¨ê¹€ (hidden ë³µì›)', 'pass');
      } else {
        log('âŒ FAIL: ì¬í† ê¸€ í›„ ë¯¸ìˆ¨ê¹€', 'fail');
      }

      if (toggleText.textContent === 'ì´ë ¥ ë³´ê¸° â–¼') {
        log('âœ… PASS: ì¬í† ê¸€ í›„ í…ìŠ¤íŠ¸ ë³µì›', 'pass');
      } else {
        log(`âŒ FAIL: ì¬í† ê¸€ í›„ í…ìŠ¤íŠ¸ ì˜¤ë¥˜ ("${toggleText.textContent}")`, 'fail');
      }
    }

    // ============================================================
    // G. ë²ˆí˜¸ ì œì™¸ (F-005)
    // ============================================================

    function testExcludeBasic() {
      log('â•â•â• Test 22: generateSingleSet(excludedNumbers) ì œì™¸ ë™ì‘ â•â•â•', 'info');

      const excluded = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
      let allExcluded = true;

      for (let i = 0; i < 100; i++) {
        const numbers = generateSingleSet(excluded);
        if (numbers.some(n => excluded.includes(n))) {
          allExcluded = false;
          break;
        }
      }

      if (allExcluded) {
        log('âœ… PASS: 100íšŒ ì¶”ì²¨ ì¤‘ ì œì™¸ ë²ˆí˜¸ ë¯¸ì¶œí˜„', 'pass');
      } else {
        log('âŒ FAIL: ì œì™¸ëœ ë²ˆí˜¸ê°€ ê²°ê³¼ì— í¬í•¨ë¨', 'fail');
      }

      // ì œì™¸ ì—†ì„ ë•Œ ê¸°ì¡´ ë™ì‘ê³¼ ë™ì¼
      const noExclude = generateSingleSet([]);
      if (noExclude.length === 6 && noExclude.every(n => n >= 1 && n <= 45)) {
        log('âœ… PASS: ë¹ˆ ì œì™¸ ë°°ì—´ -> ê¸°ì¡´ ë™ì‘ ë™ì¼', 'pass');
      } else {
        log('âŒ FAIL: ë¹ˆ ì œì™¸ ë°°ì—´ ë™ì‘ ì˜¤ë¥˜', 'fail');
      }

      // ì œì™¸ í›„ì—ë„ 6ê°œ ìƒì„±, ì˜¤ë¦„ì°¨ìˆœ, ì¤‘ë³µ ì—†ìŒ
      const result = generateSingleSet([10, 20, 30, 40]);
      if (result.length === 6) {
        log('âœ… PASS: ì œì™¸ í›„ì—ë„ 6ê°œ ìƒì„±', 'pass');
      } else {
        log(`âŒ FAIL: ${result.length}ê°œ ìƒì„±`, 'fail');
      }

      const isSorted = result.every((n, i, arr) => i === 0 || arr[i - 1] < n);
      if (isSorted && new Set(result).size === 6) {
        log('âœ… PASS: ì œì™¸ í›„ ì˜¤ë¦„ì°¨ìˆœ + ì¤‘ë³µ ì—†ìŒ', 'pass');
      } else {
        log('âŒ FAIL: ì •ë ¬/ì¤‘ë³µ ì˜¤ë¥˜', 'fail');
      }
    }

    function testExcludeMultipleSets() {
      log('â•â•â• Test 23: generateMultipleSets() ì œì™¸ ì „ë‹¬ â•â•â•', 'info');

      const excluded = [1, 2, 3, 4, 5];
      const sets = generateMultipleSets(3, excluded);

      const allExcluded = sets.every(set => set.every(n => !excluded.includes(n)));
      if (allExcluded) {
        log('âœ… PASS: ì—¬ëŸ¬ ì„¸íŠ¸ ëª¨ë‘ ì œì™¸ ë²ˆí˜¸ ë¯¸í¬í•¨', 'pass');
      } else {
        log('âŒ FAIL: ì¼ë¶€ ì„¸íŠ¸ì— ì œì™¸ ë²ˆí˜¸ í¬í•¨', 'fail');
      }
    }

    function testExcludeUI() {
      log('â•â•â• Test 24: toggleExcludeView() ë° UI ë™ì‘ â•â•â•', 'info');
      resetFixture();

      const panel = document.getElementById('excludePanel');
      const toggleText = document.getElementById('excludeToggleText');
      const grid = document.getElementById('excludeGrid');

      // í† ê¸€ ì—´ê¸°
      toggleExcludeView();

      if (!panel.classList.contains('hidden')) {
        log('âœ… PASS: íŒ¨ë„ í‘œì‹œ', 'pass');
      } else {
        log('âŒ FAIL: íŒ¨ë„ ë¯¸í‘œì‹œ', 'fail');
      }

      if (toggleText.textContent === 'ë²ˆí˜¸ ì œì™¸ ì„¤ì • â–²') {
        log('âœ… PASS: í† ê¸€ í…ìŠ¤íŠ¸ ë³€ê²½', 'pass');
      } else {
        log(`âŒ FAIL: í…ìŠ¤íŠ¸ ì˜¤ë¥˜ ("${toggleText.textContent}")`, 'fail');
      }

      if (grid.children.length === 45) {
        log('âœ… PASS: 45ê°œ ë²„íŠ¼ ìƒì„±', 'pass');
      } else {
        log(`âŒ FAIL: ${grid.children.length}ê°œ ë²„íŠ¼`, 'fail');
      }

      // ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ ì œì™¸ í† ê¸€
      grid.children[0].click(); // 1ë²ˆ ì œì™¸
      grid.children[1].click(); // 2ë²ˆ ì œì™¸

      const excluded = getExcludedNumbers();
      if (excluded.length === 2 && excluded.includes(1) && excluded.includes(2)) {
        log('âœ… PASS: í´ë¦­ìœ¼ë¡œ ë²ˆí˜¸ ì œì™¸ (1, 2)', 'pass');
      } else {
        log(`âŒ FAIL: ì œì™¸ ê²°ê³¼ ì˜¤ë¥˜ ([${excluded}])`, 'fail');
      }

      // ì¹´ìš´í„° ì—…ë°ì´íŠ¸ í™•ì¸
      const countText = document.getElementById('excludeCount').textContent;
      const remainText = document.getElementById('remainCount').textContent;
      if (countText === 'ì œì™¸: 2ê°œ' && remainText === 'ë‚¨ì€ ë²ˆí˜¸: 43ê°œ') {
        log('âœ… PASS: ì¹´ìš´í„° ì—…ë°ì´íŠ¸', 'pass');
      } else {
        log(`âŒ FAIL: ì¹´ìš´í„° ì˜¤ë¥˜ ("${countText}", "${remainText}")`, 'fail');
      }

      // í† ê¸€ ë‹«ê¸°
      toggleExcludeView();
      if (panel.classList.contains('hidden')) {
        log('âœ… PASS: ì¬í† ê¸€ í›„ íŒ¨ë„ ìˆ¨ê¹€', 'pass');
      } else {
        log('âŒ FAIL: ì¬í† ê¸€ í›„ ë¯¸ìˆ¨ê¹€', 'fail');
      }
    }

    function testExcludeReset() {
      log('â•â•â• Test 25: resetExcludedNumbers() ì´ˆê¸°í™” â•â•â•', 'info');
      resetFixture();

      // íŒ¨ë„ ì—´ê¸° ë° ë²ˆí˜¸ ì œì™¸
      toggleExcludeView();
      const grid = document.getElementById('excludeGrid');
      grid.children[0].click();
      grid.children[4].click();
      grid.children[9].click();

      if (getExcludedNumbers().length === 3) {
        log('âœ… PASS: 3ê°œ ì œì™¸ ì„¤ì •', 'pass');
      } else {
        log('âŒ FAIL: ì œì™¸ ì„¤ì • ì˜¤ë¥˜', 'fail');
      }

      // ì´ˆê¸°í™”
      resetExcludedNumbers();

      if (getExcludedNumbers().length === 0) {
        log('âœ… PASS: ì´ˆê¸°í™” í›„ ì œì™¸ 0ê°œ', 'pass');
      } else {
        log(`âŒ FAIL: ì´ˆê¸°í™” í›„ ${getExcludedNumbers().length}ê°œ ë‚¨ìŒ`, 'fail');
      }

      const countText = document.getElementById('excludeCount').textContent;
      if (countText === 'ì œì™¸: 0ê°œ') {
        log('âœ… PASS: ì¹´ìš´í„° ë¦¬ì…‹', 'pass');
      } else {
        log(`âŒ FAIL: ì¹´ìš´í„° ë¯¸ë¦¬ì…‹ ("${countText}")`, 'fail');
      }
    }

    function testExcludeWarning() {
      log('â•â•â• Test 26: ì œì™¸ 39ê°œ ì´ˆê³¼ ì‹œ ê²½ê³  â•â•â•', 'info');
      resetFixture();

      toggleExcludeView();
      const grid = document.getElementById('excludeGrid');
      const warning = document.getElementById('excludeWarning');

      // 40ê°œ ì œì™¸ (ë‚¨ì€ 5ê°œ < 6)
      for (let i = 0; i < 40; i++) {
        grid.children[i].click();
      }

      if (!warning.classList.contains('hidden')) {
        log('âœ… PASS: 40ê°œ ì œì™¸ ì‹œ ê²½ê³  í‘œì‹œ', 'pass');
      } else {
        log('âŒ FAIL: ê²½ê³  ë¯¸í‘œì‹œ', 'fail');
      }

      // 1ê°œ í•´ì œ (ë‚¨ì€ 6ê°œ >= 6)
      grid.children[39].click();

      if (warning.classList.contains('hidden')) {
        log('âœ… PASS: 39ê°œ ì œì™¸ ì‹œ ê²½ê³  ìˆ¨ê¹€', 'pass');
      } else {
        log('âŒ FAIL: ê²½ê³  ë¯¸ìˆ¨ê¹€', 'fail');
      }
    }

    // ============================================================
    // H. í†µí•© í…ŒìŠ¤íŠ¸
    // ============================================================

    function testGenerateLottoNumbers() {
      log('â•â•â• Test 27: generateLottoNumbers() í†µí•© â•â•â•', 'info');
      resetFixture();

      const select = document.getElementById('setCount');
      const container = document.getElementById('setsContainer');
      const historyList = document.getElementById('historyList');
      historyList.classList.remove('hidden');

      // ë‹¨ì¼ ì„¸íŠ¸ í†µí•© í…ŒìŠ¤íŠ¸
      select.value = '1';
      generateLottoNumbers();

      const cards = container.querySelectorAll('.set-card');
      if (cards.length === 1) {
        log('âœ… PASS: 1ì„¸íŠ¸ -> 1ê°œ ì¹´ë“œ ë Œë”ë§', 'pass');
      } else {
        log(`âŒ FAIL: ${cards.length}ê°œ ì¹´ë“œ`, 'fail');
      }

      let history = loadHistory();
      if (history.length === 1) {
        log('âœ… PASS: 1ì„¸íŠ¸ -> ì´ë ¥ 1ê°œ ì €ì¥', 'pass');
      } else {
        log(`âŒ FAIL: ì´ë ¥ ${history.length}ê°œ`, 'fail');
      }

      // 3ì„¸íŠ¸ í†µí•© í…ŒìŠ¤íŠ¸
      resetFixture();
      select.value = '3';
      historyList.classList.remove('hidden');
      generateLottoNumbers();

      const cards3 = container.querySelectorAll('.set-card');
      if (cards3.length === 3) {
        log('âœ… PASS: 3ì„¸íŠ¸ -> 3ê°œ ì¹´ë“œ ë Œë”ë§', 'pass');
      } else {
        log(`âŒ FAIL: ${cards3.length}ê°œ ì¹´ë“œ`, 'fail');
      }

      history = loadHistory();
      if (history.length === 3) {
        log('âœ… PASS: 3ì„¸íŠ¸ -> ì´ë ¥ 3ê°œ ì €ì¥', 'pass');
      } else {
        log(`âŒ FAIL: ì´ë ¥ ${history.length}ê°œ`, 'fail');
      }

      if (history.every(h => h.setCount === 3)) {
        log('âœ… PASS: ëª¨ë“  ì´ë ¥ setCount=3', 'pass');
      } else {
        log('âŒ FAIL: setCount ë¶ˆì¼ì¹˜', 'fail');
      }

      // ê° ì¹´ë“œì˜ ìˆ«ìê°€ ìœ íš¨í•œì§€ í™•ì¸
      const allValid = Array.from(cards3).every(card => {
        const nums = Array.from(card.querySelectorAll('.number')).map(el => parseInt(el.textContent));
        return nums.length === 6 &&
          nums.every(n => n >= 1 && n <= 45) &&
          new Set(nums).size === 6;
      });

      if (allValid) {
        log('âœ… PASS: ëª¨ë“  ì¹´ë“œ ìˆ«ì ìœ íš¨ (ë²”ìœ„, ì¤‘ë³µ, ê°œìˆ˜)', 'pass');
      } else {
        log('âŒ FAIL: ì¼ë¶€ ì¹´ë“œ ìˆ«ì ê²€ì¦ ì‹¤íŒ¨', 'fail');
      }

      select.value = '1'; // ë³µì›
    }

    // ============================================================
    // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    // ============================================================

    async function runAllTests() {
      clearResults();
      resetFixture();
      log('ğŸš€ ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘ (v2 - ì‹¤ì œ ì½”ë“œ ê²€ì¦)', 'info');
      logSeparator();

      // A. í•µì‹¬ ìƒì„± ë¡œì§
      testBasicGeneration();       logSeparator();
      testNumberRange();           logSeparator();
      testNoDuplicates();          logSeparator();
      testSorting();               logSeparator();
      testRandomness();            logSeparator();
      testDistribution();          logSeparator();

      // B. ìœ í‹¸ë¦¬í‹°
      testGenerateUUID();          logSeparator();

      // C. ì´ë ¥ ê´€ë¦¬
      testHistorySave();           logSeparator();
      testHistoryLoad();           logSeparator();
      testHistoryMaxLimit();       logSeparator();
      testClearHistory();          logSeparator();
      testSetCountInHistory();     logSeparator();

      // D. ì—¬ëŸ¬ ì„¸íŠ¸
      testMultipleSets();          logSeparator();
      testMultipleSetsBoundary();  logSeparator();
      testGetSelectedSetCount();   logSeparator();

      // E. ë³µì‚¬ ë° í† ìŠ¤íŠ¸ (async)
      await testCopyFunction();    logSeparator();
      await testToastFunction();   logSeparator();

      // F. DOM ë Œë”ë§
      testDisplayMultipleSets();   logSeparator();
      testDisplayHistory();        logSeparator();
      testToggleHistoryView();     logSeparator();

      // G. ë²ˆí˜¸ ì œì™¸ (F-005)
      testExcludeBasic();          logSeparator();
      testExcludeMultipleSets();   logSeparator();
      testExcludeUI();             logSeparator();
      testExcludeReset();          logSeparator();
      testExcludeWarning();        logSeparator();

      // H. í†µí•©
      testGenerateLottoNumbers();  logSeparator();

      // ì •ë¦¬ & ìš”ì•½
      resetFixture();
      showSummary();
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    window.addEventListener('load', () => {
      setTimeout(runAllTests, 300);
    });
  </script>
</body>
</html>
