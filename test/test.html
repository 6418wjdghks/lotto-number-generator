<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¡œë˜ë²ˆí˜¸ ì¶”ì²¨ê¸° - DOM/UI í…ŒìŠ¤íŠ¸</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    /* í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ (app ìŠ¤íƒ€ì¼ ìœ„ì— ì˜¤ë²„ë¼ì´ë“œ) */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
      min-height: auto;
      display: block;
    }

    h1 {
      color: #333;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
      font-size: 1.8em;
      margin-bottom: 10px;
    }

    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .test-section h2 {
      color: #667eea;
      margin-top: 0;
    }

    .result {
      padding: 10px 15px;
      margin: 5px 0;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    .result.pass {
      background: #d4edda;
      border-left: 4px solid #28a745;
      color: #155724;
    }

    .result.fail {
      background: #f8d7da;
      border-left: 4px solid #dc3545;
      color: #721c24;
    }

    .result.info {
      background: #d1ecf1;
      border-left: 4px solid #0c5460;
      color: #0c5460;
    }

    .result.separator {
      background: transparent;
      border: none;
      padding: 2px;
      margin: 0;
    }

    .test-controls button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 15px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }

    .test-controls button:hover {
      opacity: 0.9;
      transform: none;
      box-shadow: none;
    }

    .summary-bar {
      display: flex;
      gap: 15px;
      padding: 15px 20px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      margin-top: 15px;
    }

    .summary-bar.all-pass {
      background: #d4edda;
      color: #155724;
    }

    .summary-bar.has-fail {
      background: #f8d7da;
      color: #721c24;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }

    .stat-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      border-left: 4px solid #667eea;
    }

    .stat-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #333;
    }

    /* DOM Fixture ì˜ì—­ - í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œë§Œ ì‚¬ìš© */
    #testFixture {
      display: none !important;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª ë¡œë˜ë²ˆí˜¸ ì¶”ì²¨ê¸° - DOM/UI í…ŒìŠ¤íŠ¸</h1>

  <!--
    DOM Fixture: app.jsê°€ ì°¸ì¡°í•˜ëŠ” DOM ìš”ì†Œë“¤.
    ì‹¤ì œ index.htmlì˜ êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ì¬í˜„í•©ë‹ˆë‹¤.
  -->
  <div id="testFixture">
    <button id="btnThemeToggle">ğŸŒ™</button>
    <div id="authGuest">
      <button id="btnToggleAuth"><span id="authToggleText">ë¡œê·¸ì¸ / íšŒì›ê°€ì… â–¼</span></button>
      <div id="authForm" class="hidden">
        <input type="email" id="authEmail" />
        <input type="password" id="authPassword" />
        <button id="btnSignIn">ë¡œê·¸ì¸</button>
        <button id="btnSignUp">íšŒì›ê°€ì…</button>
      </div>
    </div>
    <div id="authUser" class="hidden"><span id="authUserEmail"></span>
      <button id="btnSignOut">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
    <select id="setCount">
      <option value="1" selected>1ê°œ</option>
      <option value="2">2ê°œ</option>
      <option value="3">3ê°œ</option>
      <option value="4">4ê°œ</option>
      <option value="5">5ê°œ</option>
    </select>
    <button id="btnToggleExclude"><span id="excludeToggleText">ë²ˆí˜¸ ì œì™¸ ì„¤ì • â–¼</span></button>
    <div id="excludePanel" class="exclude-panel hidden">
      <span id="excludeCount">ì œì™¸: 0ê°œ</span>
      <span id="remainCount">ë‚¨ì€ ë²ˆí˜¸: 45ê°œ</span>
      <button id="btnResetExclude">ì´ˆê¸°í™”</button>
      <div class="exclude-grid" id="excludeGrid"></div>
      <div id="excludeWarning" class="exclude-warning hidden"></div>
    </div>
    <button id="btnGenerate">ì¶”ì²¨í•˜ê¸°</button>
    <div class="sets-container" id="setsContainer"></div>
    <button id="btnToggleHistory"><span id="historyToggleText">ì´ë ¥ ë³´ê¸° â–¼</span></button>
    <button id="btnClearHistory">ì „ì²´ ì‚­ì œ</button>
    <div id="historyList" class="history-list hidden"></div>
  </div>

  <div class="test-section">
    <h2>í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤</h2>
    <p style="color:#666; font-size:13px; margin-top:0;">
      ìˆœìˆ˜ ë¡œì§ í…ŒìŠ¤íŠ¸ëŠ” CLIì—ì„œ ì‹¤í–‰: <code>node --test test/test-logic.js</code><br>
      ì´ í˜ì´ì§€ëŠ” DOM/UI ì˜ì¡´ í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰í•©ë‹ˆë‹¤.
    </p>
    <div class="test-controls">
      <button onclick="runAllTests()">ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
      <button onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="test-section">
    <h2>í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
    <div id="testResults"></div>
    <div id="summaryBar"></div>
  </div>

  <div class="test-section">
    <h2>ë¶„í¬ í†µê³„ (1000íšŒ ì¶”ì²¨)</h2>
    <div class="stats" id="stats"></div>
  </div>

  <script src="../js/config.js"></script>
  <script src="../js/utils.js"></script>
  <script src="../js/theme.js"></script>
  <script src="../js/exclude.js"></script>
  <script src="../js/lottery.js"></script>
  <script src="../js/history.js"></script>
  <script src="../js/auth.js"></script>
  <script src="../js/app.js"></script>
  <script>
    // ============================================================
    // í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹°
    // ============================================================

    let testResults = [];

    function log(message, type = 'info') {
      console.log(`[${type.toUpperCase()}] ${message}`);
      const resultsDiv = document.getElementById('testResults');
      const resultDiv = document.createElement('div');
      resultDiv.className = `result ${type}`;
      resultDiv.textContent = message;
      resultsDiv.appendChild(resultDiv);
      testResults.push({ message, type });
    }

    function logSeparator() {
      const resultsDiv = document.getElementById('testResults');
      const div = document.createElement('div');
      div.className = 'result separator';
      resultsDiv.appendChild(div);
    }

    function clearResults() {
      document.getElementById('testResults').innerHTML = '';
      document.getElementById('summaryBar').innerHTML = '';
      document.getElementById('stats').innerHTML = '';
      testResults = [];
    }

    function waitFor(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    /** DOM Fixtureë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ë¦¬ì…‹ */
    function resetFixture() {
      localStorage.removeItem(STORAGE_KEY);
      localStorage.removeItem(EXCLUDED_KEY);
      document.getElementById('setsContainer').innerHTML = '';
      document.getElementById('historyList').innerHTML = '';
      document.getElementById('historyList').classList.add('hidden');
      document.getElementById('historyToggleText').textContent = 'ì´ë ¥ ë³´ê¸° â–¼';
      document.getElementById('setCount').value = '1';
      document.getElementById('excludeGrid').innerHTML = '';
      document.getElementById('excludePanel').classList.add('hidden');
      document.getElementById('excludeToggleText').textContent = 'ë²ˆí˜¸ ì œì™¸ ì„¤ì • â–¼';
      document.getElementById('excludeCount').textContent = 'ì œì™¸: 0ê°œ';
      document.getElementById('remainCount').textContent = 'ë‚¨ì€ ë²ˆí˜¸: 45ê°œ';
      document.getElementById('excludeWarning').classList.add('hidden');
      document.querySelectorAll('.toast').forEach(t => t.remove());
      localStorage.removeItem(THEME_KEY);
      document.documentElement.removeAttribute('data-theme');
      document.getElementById('btnThemeToggle').textContent = 'ğŸŒ™';
    }

    function showSummary() {
      const passCount = testResults.filter(r => r.type === 'pass').length;
      const failCount = testResults.filter(r => r.type === 'fail').length;
      const total = passCount + failCount;
      const allPass = failCount === 0;

      log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
      log(`í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${passCount} í†µê³¼ / ${failCount} ì‹¤íŒ¨ (ì´ ${total}ê°œ ê²€ì¦)`,
        allPass ? 'pass' : 'fail');

      const bar = document.getElementById('summaryBar');
      bar.className = `summary-bar ${allPass ? 'all-pass' : 'has-fail'}`;
      bar.innerHTML = `
        <span>${allPass ? 'âœ…' : 'âŒ'} ${passCount} í†µê³¼</span>
        <span>${failCount > 0 ? 'âŒ ' + failCount + ' ì‹¤íŒ¨' : ''}</span>
        <span>ì´ ${total}ê°œ ê²€ì¦</span>
      `;

      document.body.dataset.testComplete = 'true';
      document.body.dataset.testFailed = String(failCount > 0);
      document.body.dataset.testPassCount = String(passCount);
      document.body.dataset.testFailCount = String(failCount);
    }

    /** ë¶„í¬ í†µê³„ ì‹œê°í™” (í…ŒìŠ¤íŠ¸ê°€ ì•„ë‹Œ ì°¸ê³  ë„êµ¬) */
    function showDistributionStats() {
      const iterations = 1000;
      const frequency = new Array(46).fill(0);

      for (let i = 0; i < iterations; i++) {
        generateSingleSet().forEach(n => frequency[n]++);
      }

      const counts = frequency.slice(1);
      const total = counts.reduce((a, b) => a + b, 0);
      const average = total / 45;
      const maxCount = Math.max(...counts);
      const minCount = Math.min(...counts);
      const variance = counts.reduce((sum, c) => sum + Math.pow(c - average, 2), 0) / 45;
      const stdDev = Math.sqrt(variance);

      const statsDiv = document.getElementById('stats');
      statsDiv.innerHTML = `
        <div class="stat-card">
          <div class="stat-label">ì´ ì¶”ì²¨</div>
          <div class="stat-value">${iterations}íšŒ</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">í‰ê·  ì¶œí˜„</div>
          <div class="stat-value">${average.toFixed(1)}íšŒ</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ìµœëŒ€ ì¶œí˜„</div>
          <div class="stat-value">${maxCount}íšŒ</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ìµœì†Œ ì¶œí˜„</div>
          <div class="stat-value">${minCount}íšŒ</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">í‘œì¤€í¸ì°¨</div>
          <div class="stat-value">${stdDev.toFixed(2)}</div>
        </div>
      `;
    }

    // ============================================================
    // A. ì´ë ¥ ê´€ë¦¬ - DOM ì˜ì¡´ (clearHistory)
    // ============================================================

    async function testClearHistory() {
      log('â•â•â• Test 1: clearHistory() confirm/alert ë™ì‘ â•â•â•', 'info');
      resetFixture();

      const origConfirm = window.confirm;
      const origAlert = window.alert;
      let alertMsg = '';

      // Case 1: ë¹ˆ ì´ë ¥ì—ì„œ ì‚­ì œ ì‹œë„
      window.alert = (msg) => { alertMsg = msg; };
      window.confirm = () => true;
      await clearHistory();

      if (alertMsg === 'ì‚­ì œí•  ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.') {
        log('âœ… PASS: ë¹ˆ ì´ë ¥ ì‚­ì œ ì‹œ ê²½ê³  ë©”ì‹œì§€', 'pass');
      } else {
        log(`âŒ FAIL: ë¹ˆ ì´ë ¥ ê²½ê³  ë¯¸í‘œì‹œ ("${alertMsg}")`, 'fail');
      }

      // Case 2: confirm ìŠ¹ì¸ ì‹œ ì‚­ì œ
      await saveToHistory([1, 2, 3, 4, 5, 6]);
      alertMsg = '';
      window.confirm = () => true;
      window.alert = (msg) => { alertMsg = msg; };
      await clearHistory();

      if ((await loadHistory()).length === 0) {
        log('âœ… PASS: confirm ìŠ¹ì¸ -> ì´ë ¥ ì‚­ì œ', 'pass');
      } else {
        log('âŒ FAIL: ì´ë ¥ ì‚­ì œ ì‹¤íŒ¨', 'fail');
      }

      if (alertMsg === 'ì´ë ¥ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.') {
        log('âœ… PASS: ì‚­ì œ ì™„ë£Œ ì•Œë¦¼ ë©”ì‹œì§€', 'pass');
      } else {
        log(`âŒ FAIL: ì™„ë£Œ ë©”ì‹œì§€ ì˜¤ë¥˜ ("${alertMsg}")`, 'fail');
      }

      // Case 3: confirm ê±°ë¶€ ì‹œ ìœ ì§€
      await saveToHistory([7, 8, 9, 10, 11, 12]);
      window.confirm = () => false;
      window.alert = () => {};
      await clearHistory();

      if ((await loadHistory()).length === 1) {
        log('âœ… PASS: confirm ê±°ë¶€ -> ì´ë ¥ ìœ ì§€', 'pass');
      } else {
        log('âŒ FAIL: confirm ê±°ë¶€ í›„ ì´ë ¥ ë³€ê²½ë¨', 'fail');
      }

      window.confirm = origConfirm;
      window.alert = origAlert;
    }

    // ============================================================
    // B. DOM ì—°ë™ (getSelectedSetCount)
    // ============================================================

    function testGetSelectedSetCount() {
      log('â•â•â• Test 2: getSelectedSetCount() DOM ì—°ë™ â•â•â•', 'info');

      const select = document.getElementById('setCount');

      select.value = '1';
      if (getSelectedSetCount() === 1) {
        log('âœ… PASS: ê¸°ë³¸ê°’ 1 ë°˜í™˜', 'pass');
      } else {
        log(`âŒ FAIL: ê¸°ë³¸ê°’ ì˜¤ë¥˜ (${getSelectedSetCount()})`, 'fail');
      }

      select.value = '5';
      if (getSelectedSetCount() === 5) {
        log('âœ… PASS: ìµœëŒ€ê°’ 5 ë°˜í™˜', 'pass');
      } else {
        log(`âŒ FAIL: ìµœëŒ€ê°’ ì˜¤ë¥˜ (${getSelectedSetCount()})`, 'fail');
      }

      select.value = '3';
      if (typeof getSelectedSetCount() === 'number') {
        log('âœ… PASS: number íƒ€ì… ë°˜í™˜', 'pass');
      } else {
        log(`âŒ FAIL: ë°˜í™˜ íƒ€ì… ì˜¤ë¥˜ (${typeof getSelectedSetCount()})`, 'fail');
      }

      select.value = '1';
    }

    // ============================================================
    // C. ë³µì‚¬ ë° í† ìŠ¤íŠ¸ (F-006)
    // ============================================================

    async function testCopyFunction() {
      log('â•â•â• Test 3: copyToClipboard() â•â•â•', 'info');

      const testNumbers = [3, 12, 19, 27, 38, 42];

      if (!navigator.clipboard || !navigator.clipboard.writeText) {
        const result = await copyToClipboard(testNumbers);
        log(`âš ï¸ INFO: Clipboard API ë¯¸ì§€ì› (HTTPS í•„ìš”) - false ë°˜í™˜ í™•ì¸ (${result === false}), ìŠ¤í‚µ`, 'info');
        return;
      }

      const result = await copyToClipboard(testNumbers);

      if (result === true) {
        log('âœ… PASS: ë³µì‚¬ ì„±ê³µ (true ë°˜í™˜)', 'pass');
      } else {
        log('âŒ FAIL: ë³µì‚¬ ì‹¤íŒ¨', 'fail');
      }

      try {
        const clipText = await navigator.clipboard.readText();
        if (clipText === '3, 12, 19, 27, 38, 42') {
          log('âœ… PASS: í´ë¦½ë³´ë“œ ë‚´ìš© ì¼ì¹˜', 'pass');
        } else {
          log(`âŒ FAIL: í´ë¦½ë³´ë“œ ë‚´ìš© ë¶ˆì¼ì¹˜ ("${clipText}")`, 'fail');
        }
      } catch (error) {
        log('âš ï¸ INFO: í´ë¦½ë³´ë“œ ì½ê¸° ê¶Œí•œ ì—†ìŒ - ë‚´ìš© ê²€ì¦ ìŠ¤í‚µ', 'info');
      }

      await copyToClipboard(testNumbers, 2);
      await waitFor(50);
      const toast = document.querySelector('.toast');
      if (toast && toast.textContent.includes('2íšŒì°¨')) {
        log('âœ… PASS: setNumber ë°˜ì˜ëœ í† ìŠ¤íŠ¸ ë©”ì‹œì§€', 'pass');
      } else {
        log('âŒ FAIL: setNumber ë¯¸ë°˜ì˜', 'fail');
      }

      document.querySelectorAll('.toast').forEach(t => t.remove());
    }

    async function testToastFunction() {
      log('â•â•â• Test 4: showToast() ë™ì‘ â•â•â•', 'info');

      document.querySelectorAll('.toast').forEach(t => t.remove());

      showToast('ì„±ê³µ ë©”ì‹œì§€', 'success', 500);
      await waitFor(50);

      let toast = document.querySelector('.toast');
      if (toast) {
        log('âœ… PASS: í† ìŠ¤íŠ¸ DOM ìƒì„±', 'pass');
      } else {
        log('âŒ FAIL: í† ìŠ¤íŠ¸ DOM ë¯¸ìƒì„±', 'fail');
        return;
      }

      if (toast.classList.contains('success')) {
        log('âœ… PASS: success í´ë˜ìŠ¤ ì ìš©', 'pass');
      } else {
        log('âŒ FAIL: success í´ë˜ìŠ¤ ë¯¸ì ìš©', 'fail');
      }

      if (toast.textContent === 'ì„±ê³µ ë©”ì‹œì§€') {
        log('âœ… PASS: ë©”ì‹œì§€ ë‚´ìš© ì¼ì¹˜', 'pass');
      } else {
        log(`âŒ FAIL: ë©”ì‹œì§€ ë¶ˆì¼ì¹˜ ("${toast.textContent}")`, 'fail');
      }

      await waitFor(1000);

      if (!document.querySelector('.toast')) {
        log('âœ… PASS: í† ìŠ¤íŠ¸ ìë™ ì œê±°', 'pass');
      } else {
        log('âŒ FAIL: í† ìŠ¤íŠ¸ ìë™ ì œê±° ì‹¤íŒ¨', 'fail');
      }

      showToast('ì—ëŸ¬ ë©”ì‹œì§€', 'error', 500);
      await waitFor(50);

      toast = document.querySelector('.toast');
      if (toast && toast.classList.contains('error')) {
        log('âœ… PASS: error í´ë˜ìŠ¤ ì ìš©', 'pass');
      } else {
        log('âŒ FAIL: error í´ë˜ìŠ¤ ë¯¸ì ìš©', 'fail');
      }

      showToast('ì²« ë²ˆì§¸', 'success', 2000);
      showToast('ë‘ ë²ˆì§¸', 'success', 500);
      await waitFor(50);

      const toasts = document.querySelectorAll('.toast');
      if (toasts.length === 1 && toasts[0].textContent === 'ë‘ ë²ˆì§¸') {
        log('âœ… PASS: ì—°ì† í˜¸ì¶œ ì‹œ êµì²´ ì •ìƒ', 'pass');
      } else {
        log(`âŒ FAIL: í† ìŠ¤íŠ¸ êµì²´ ì˜¤ë¥˜ (${toasts.length}ê°œ ì¡´ì¬)`, 'fail');
      }

      await waitFor(1000);
      document.querySelectorAll('.toast').forEach(t => t.remove());
    }

    // ============================================================
    // D. DOM ë Œë”ë§
    // ============================================================

    function testDisplayMultipleSets() {
      log('â•â•â• Test 5: displayMultipleSets() DOM ë Œë”ë§ â•â•â•', 'info');
      resetFixture();

      const testSets = [[1, 5, 12, 23, 34, 45], [2, 10, 20, 30, 40, 44]];
      displayMultipleSets(testSets);

      const container = document.getElementById('setsContainer');
      const cards = container.querySelectorAll('.set-card');

      if (cards.length === 2) {
        log('âœ… PASS: 2ê°œ ì„¸íŠ¸ ì¹´ë“œ ìƒì„±', 'pass');
      } else {
        log(`âŒ FAIL: ${cards.length}ê°œ ì¹´ë“œ (ì˜ˆìƒ: 2)`, 'fail');
      }

      const labels = container.querySelectorAll('.set-label');
      if (labels[0].textContent === '1íšŒì°¨' && labels[1].textContent === '2íšŒì°¨') {
        log('âœ… PASS: ì„¸íŠ¸ ë¼ë²¨ ("1íšŒì°¨", "2íšŒì°¨")', 'pass');
      } else {
        log('âŒ FAIL: ì„¸íŠ¸ ë¼ë²¨ ì˜¤ë¥˜', 'fail');
      }

      const firstNumbers = cards[0].querySelectorAll('.number');
      if (firstNumbers.length === 6) {
        log('âœ… PASS: ì²« ë²ˆì§¸ ì¹´ë“œ 6ê°œ ìˆ«ì ë±ƒì§€', 'pass');
      } else {
        log(`âŒ FAIL: ${firstNumbers.length}ê°œ ë±ƒì§€`, 'fail');
      }

      if (firstNumbers[0].textContent === '1' && firstNumbers[5].textContent === '45') {
        log('âœ… PASS: textContentë¡œ ìˆ«ì ì„¤ì • (XSS ì•ˆì „)', 'pass');
      } else {
        log('âŒ FAIL: ìˆ«ì í‘œì‹œ ì˜¤ë¥˜', 'fail');
      }

      const copyBtns = container.querySelectorAll('.copy-btn');
      if (copyBtns.length === 2) {
        log('âœ… PASS: ê° ì¹´ë“œì— ë³µì‚¬ ë²„íŠ¼', 'pass');
      } else {
        log(`âŒ FAIL: ë³µì‚¬ ë²„íŠ¼ ${copyBtns.length}ê°œ`, 'fail');
      }

      displayMultipleSets([[1, 2, 3, 4, 5, 6]]);
      if (container.querySelectorAll('.set-card').length === 1) {
        log('âœ… PASS: ì¬í˜¸ì¶œ ì‹œ ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”', 'pass');
      } else {
        log('âŒ FAIL: ê¸°ì¡´ ë‚´ìš© ë¯¸ì´ˆê¸°í™”', 'fail');
      }
    }

    async function testDisplayHistory() {
      log('â•â•â• Test 6: displayHistory() DOM ë Œë”ë§ â•â•â•', 'info');
      resetFixture();

      const historyList = document.getElementById('historyList');
      historyList.classList.remove('hidden');

      await displayHistory();
      const emptyMsg = historyList.querySelector('.history-empty');
      if (emptyMsg && emptyMsg.textContent === 'ì•„ì§ ì¶”ì²¨ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.') {
        log('âœ… PASS: ë¹ˆ ì´ë ¥ ë©”ì‹œì§€ í‘œì‹œ', 'pass');
      } else {
        log('âŒ FAIL: ë¹ˆ ì´ë ¥ ë©”ì‹œì§€ ë¯¸í‘œì‹œ', 'fail');
      }

      const testData = {
        version: '1.0',
        history: [
          { id: 'h-1', numbers: [3, 12, 19, 27, 38, 42], timestamp: '2026-02-11T10:30:00.000Z', setCount: 1 },
          { id: 'h-2', numbers: [5, 15, 25, 35, 40, 45], timestamp: '2026-02-11T09:00:00.000Z', setCount: 3 }
        ]
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(testData));
      await displayHistory();

      const items = historyList.querySelectorAll('.history-item');
      if (items.length === 2) {
        log('âœ… PASS: ì´ë ¥ 2ê°œ í•­ëª© ë Œë”ë§', 'pass');
      } else {
        log(`âŒ FAIL: ${items.length}ê°œ ë Œë”ë§`, 'fail');
      }

      const numbersText = items[0].querySelector('.history-numbers').textContent;
      if (numbersText === '3, 12, 19, 27, 38, 42') {
        log('âœ… PASS: ìˆ«ì í‘œì‹œ ì •ìƒ', 'pass');
      } else {
        log(`âŒ FAIL: ìˆ«ì í‘œì‹œ ì˜¤ë¥˜ ("${numbersText}")`, 'fail');
      }

      const timeText = items[0].querySelector('.history-time').textContent;
      if (timeText.includes('2026')) {
        log('âœ… PASS: ì‹œê°„ í¬ë§· í¬í•¨ (ì—°ë„)', 'pass');
      } else {
        log(`âŒ FAIL: ì‹œê°„ í¬ë§· ì˜¤ë¥˜ ("${timeText}")`, 'fail');
      }

      const timeText2 = items[1].querySelector('.history-time').textContent;
      if (timeText2.includes('3ì„¸íŠ¸ ì¤‘')) {
        log('âœ… PASS: setCount í‘œì‹œ ("3ì„¸íŠ¸ ì¤‘")', 'pass');
      } else {
        log(`âŒ FAIL: setCount ë¯¸í‘œì‹œ ("${timeText2}")`, 'fail');
      }
    }

    async function testToggleHistoryView() {
      log('â•â•â• Test 7: toggleHistoryView() í† ê¸€ ë™ì‘ â•â•â•', 'info');
      resetFixture();

      const historyList = document.getElementById('historyList');
      const toggleText = document.getElementById('historyToggleText');

      if (historyList.classList.contains('hidden')) {
        log('âœ… PASS: ì´ˆê¸° ìƒíƒœ hidden', 'pass');
      } else {
        log('âŒ FAIL: ì´ˆê¸° ìƒíƒœ ë¯¸hidden', 'fail');
      }

      if (toggleText.textContent === 'ì´ë ¥ ë³´ê¸° â–¼') {
        log('âœ… PASS: ì´ˆê¸° ë²„íŠ¼ í…ìŠ¤íŠ¸ "ì´ë ¥ ë³´ê¸° â–¼"', 'pass');
      } else {
        log(`âŒ FAIL: ì´ˆê¸° í…ìŠ¤íŠ¸ ì˜¤ë¥˜ ("${toggleText.textContent}")`, 'fail');
      }

      toggleHistoryView();
      await waitFor(0); // displayHistory() ë‚´ë¶€ await í•´ì†Œ ëŒ€ê¸°

      if (!historyList.classList.contains('hidden')) {
        log('âœ… PASS: í† ê¸€ í›„ í‘œì‹œ (hidden ì œê±°)', 'pass');
      } else {
        log('âŒ FAIL: í† ê¸€ í›„ì—ë„ hidden', 'fail');
      }

      if (toggleText.textContent === 'ì´ë ¥ ìˆ¨ê¸°ê¸° â–²') {
        log('âœ… PASS: í† ê¸€ í›„ í…ìŠ¤íŠ¸ "ì´ë ¥ ìˆ¨ê¸°ê¸° â–²"', 'pass');
      } else {
        log(`âŒ FAIL: í† ê¸€ í›„ í…ìŠ¤íŠ¸ ì˜¤ë¥˜ ("${toggleText.textContent}")`, 'fail');
      }

      toggleHistoryView();

      if (historyList.classList.contains('hidden')) {
        log('âœ… PASS: ì¬í† ê¸€ í›„ ìˆ¨ê¹€ (hidden ë³µì›)', 'pass');
      } else {
        log('âŒ FAIL: ì¬í† ê¸€ í›„ ë¯¸ìˆ¨ê¹€', 'fail');
      }

      if (toggleText.textContent === 'ì´ë ¥ ë³´ê¸° â–¼') {
        log('âœ… PASS: ì¬í† ê¸€ í›„ í…ìŠ¤íŠ¸ ë³µì›', 'pass');
      } else {
        log(`âŒ FAIL: ì¬í† ê¸€ í›„ í…ìŠ¤íŠ¸ ì˜¤ë¥˜ ("${toggleText.textContent}")`, 'fail');
      }
    }

    // ============================================================
    // E. ë²ˆí˜¸ ì œì™¸ UI (F-005)
    // ============================================================

    function testExcludeUI() {
      log('â•â•â• Test 8: toggleExcludeView() ë° UI ë™ì‘ â•â•â•', 'info');
      resetFixture();

      const panel = document.getElementById('excludePanel');
      const toggleText = document.getElementById('excludeToggleText');
      const grid = document.getElementById('excludeGrid');

      toggleExcludeView();

      if (!panel.classList.contains('hidden')) {
        log('âœ… PASS: íŒ¨ë„ í‘œì‹œ', 'pass');
      } else {
        log('âŒ FAIL: íŒ¨ë„ ë¯¸í‘œì‹œ', 'fail');
      }

      if (toggleText.textContent === 'ë²ˆí˜¸ ì œì™¸ ì„¤ì • â–²') {
        log('âœ… PASS: í† ê¸€ í…ìŠ¤íŠ¸ ë³€ê²½', 'pass');
      } else {
        log(`âŒ FAIL: í…ìŠ¤íŠ¸ ì˜¤ë¥˜ ("${toggleText.textContent}")`, 'fail');
      }

      if (grid.children.length === 45) {
        log('âœ… PASS: 45ê°œ ë²„íŠ¼ ìƒì„±', 'pass');
      } else {
        log(`âŒ FAIL: ${grid.children.length}ê°œ ë²„íŠ¼`, 'fail');
      }

      grid.children[0].click();
      grid.children[1].click();

      const excluded = getExcludedNumbers();
      if (excluded.length === 2 && excluded.includes(1) && excluded.includes(2)) {
        log('âœ… PASS: í´ë¦­ìœ¼ë¡œ ë²ˆí˜¸ ì œì™¸ (1, 2)', 'pass');
      } else {
        log(`âŒ FAIL: ì œì™¸ ê²°ê³¼ ì˜¤ë¥˜ ([${excluded}])`, 'fail');
      }

      const countText = document.getElementById('excludeCount').textContent;
      const remainText = document.getElementById('remainCount').textContent;
      if (countText === 'ì œì™¸: 2ê°œ' && remainText === 'ë‚¨ì€ ë²ˆí˜¸: 43ê°œ') {
        log('âœ… PASS: ì¹´ìš´í„° ì—…ë°ì´íŠ¸', 'pass');
      } else {
        log(`âŒ FAIL: ì¹´ìš´í„° ì˜¤ë¥˜ ("${countText}", "${remainText}")`, 'fail');
      }

      toggleExcludeView();
      if (panel.classList.contains('hidden')) {
        log('âœ… PASS: ì¬í† ê¸€ í›„ íŒ¨ë„ ìˆ¨ê¹€', 'pass');
      } else {
        log('âŒ FAIL: ì¬í† ê¸€ í›„ ë¯¸ìˆ¨ê¹€', 'fail');
      }
    }

    function testExcludeReset() {
      log('â•â•â• Test 9: resetExcludedNumbers() ì´ˆê¸°í™” â•â•â•', 'info');
      resetFixture();

      toggleExcludeView();
      const grid = document.getElementById('excludeGrid');
      grid.children[0].click();
      grid.children[4].click();
      grid.children[9].click();

      if (getExcludedNumbers().length === 3) {
        log('âœ… PASS: 3ê°œ ì œì™¸ ì„¤ì •', 'pass');
      } else {
        log('âŒ FAIL: ì œì™¸ ì„¤ì • ì˜¤ë¥˜', 'fail');
      }

      resetExcludedNumbers();

      if (getExcludedNumbers().length === 0) {
        log('âœ… PASS: ì´ˆê¸°í™” í›„ ì œì™¸ 0ê°œ', 'pass');
      } else {
        log(`âŒ FAIL: ì´ˆê¸°í™” í›„ ${getExcludedNumbers().length}ê°œ ë‚¨ìŒ`, 'fail');
      }

      const countText = document.getElementById('excludeCount').textContent;
      if (countText === 'ì œì™¸: 0ê°œ') {
        log('âœ… PASS: ì¹´ìš´í„° ë¦¬ì…‹', 'pass');
      } else {
        log(`âŒ FAIL: ì¹´ìš´í„° ë¯¸ë¦¬ì…‹ ("${countText}")`, 'fail');
      }
    }

    function testExcludeWarning() {
      log('â•â•â• Test 10: ì œì™¸ 39ê°œ ì´ˆê³¼ ì‹œ ê²½ê³  â•â•â•', 'info');
      resetFixture();

      toggleExcludeView();
      const grid = document.getElementById('excludeGrid');
      const warning = document.getElementById('excludeWarning');

      for (let i = 0; i < 40; i++) {
        grid.children[i].click();
      }

      if (!warning.classList.contains('hidden')) {
        log('âœ… PASS: 40ê°œ ì œì™¸ ì‹œ ê²½ê³  í‘œì‹œ', 'pass');
      } else {
        log('âŒ FAIL: ê²½ê³  ë¯¸í‘œì‹œ', 'fail');
      }

      grid.children[39].click();

      if (warning.classList.contains('hidden')) {
        log('âœ… PASS: 39ê°œ ì œì™¸ ì‹œ ê²½ê³  ìˆ¨ê¹€', 'pass');
      } else {
        log('âŒ FAIL: ê²½ê³  ë¯¸ìˆ¨ê¹€', 'fail');
      }
    }

    // ============================================================
    // F. í†µí•© í…ŒìŠ¤íŠ¸
    // ============================================================

    async function testGenerateLottoNumbers() {
      log('â•â•â• Test 11: generateLottoNumbers() í†µí•© â•â•â•', 'info');
      resetFixture();

      const select = document.getElementById('setCount');
      const container = document.getElementById('setsContainer');
      const historyList = document.getElementById('historyList');
      historyList.classList.remove('hidden');

      // ë‹¨ì¼ ì„¸íŠ¸ í†µí•© í…ŒìŠ¤íŠ¸
      select.value = '1';
      generateLottoNumbers();
      await waitFor(0); // saveToHistory async í•´ì†Œ ëŒ€ê¸°

      const cards = container.querySelectorAll('.set-card');
      if (cards.length === 1) {
        log('âœ… PASS: 1ì„¸íŠ¸ -> 1ê°œ ì¹´ë“œ ë Œë”ë§', 'pass');
      } else {
        log(`âŒ FAIL: ${cards.length}ê°œ ì¹´ë“œ`, 'fail');
      }

      let history = await loadHistory();
      if (history.length === 1) {
        log('âœ… PASS: 1ì„¸íŠ¸ -> ì´ë ¥ 1ê°œ ì €ì¥', 'pass');
      } else {
        log(`âŒ FAIL: ì´ë ¥ ${history.length}ê°œ`, 'fail');
      }

      // 3ì„¸íŠ¸ í†µí•© í…ŒìŠ¤íŠ¸
      resetFixture();
      select.value = '3';
      historyList.classList.remove('hidden');
      generateLottoNumbers();
      await waitFor(0); // saveToHistory async í•´ì†Œ ëŒ€ê¸°

      const cards3 = container.querySelectorAll('.set-card');
      if (cards3.length === 3) {
        log('âœ… PASS: 3ì„¸íŠ¸ -> 3ê°œ ì¹´ë“œ ë Œë”ë§', 'pass');
      } else {
        log(`âŒ FAIL: ${cards3.length}ê°œ ì¹´ë“œ`, 'fail');
      }

      history = await loadHistory();
      if (history.length === 3) {
        log('âœ… PASS: 3ì„¸íŠ¸ -> ì´ë ¥ 3ê°œ ì €ì¥', 'pass');
      } else {
        log(`âŒ FAIL: ì´ë ¥ ${history.length}ê°œ`, 'fail');
      }

      if (history.every(h => h.setCount === 3)) {
        log('âœ… PASS: ëª¨ë“  ì´ë ¥ setCount=3', 'pass');
      } else {
        log('âŒ FAIL: setCount ë¶ˆì¼ì¹˜', 'fail');
      }

      const allValid = Array.from(cards3).every(card => {
        const nums = Array.from(card.querySelectorAll('.number')).map(el => parseInt(el.textContent));
        return nums.length === 6 &&
          nums.every(n => n >= 1 && n <= 45) &&
          new Set(nums).size === 6;
      });

      if (allValid) {
        log('âœ… PASS: ëª¨ë“  ì¹´ë“œ ìˆ«ì ìœ íš¨ (ë²”ìœ„, ì¤‘ë³µ, ê°œìˆ˜)', 'pass');
      } else {
        log('âŒ FAIL: ì¼ë¶€ ì¹´ë“œ ìˆ«ì ê²€ì¦ ì‹¤íŒ¨', 'fail');
      }

      select.value = '1';
    }

    // ============================================================
    // G. initApp() ì´ë²¤íŠ¸ ë°”ì¸ë”© í†µí•© í…ŒìŠ¤íŠ¸
    // ============================================================

    async function testInitAppEventBinding() {
      log('â•â•â• Test 12: initApp() ì´ë²¤íŠ¸ ë°”ì¸ë”© ê²€ì¦ â•â•â•', 'info');

      // btnGenerate í´ë¦­ â†’ ì¹´ë“œ ìƒì„±
      resetFixture();
      document.getElementById('btnGenerate').click();
      await waitFor(0);

      const cards = document.getElementById('setsContainer').querySelectorAll('.set-card');
      if (cards.length >= 1) {
        log('âœ… PASS: btnGenerate í´ë¦­ â†’ ì¶”ì²¨ ì¹´ë“œ ìƒì„±', 'pass');
      } else {
        log('âŒ FAIL: btnGenerate í´ë¦­ í›„ ì¹´ë“œ ë¯¸ìƒì„± (ì´ë²¤íŠ¸ ë°”ì¸ë”© ì‹¤íŒ¨ ê°€ëŠ¥)', 'fail');
      }

      // btnToggleHistory í´ë¦­ â†’ ì´ë ¥ íŒ¨ë„ í‘œì‹œ
      resetFixture();
      document.getElementById('btnToggleHistory').click();
      await waitFor(0);

      const historyList = document.getElementById('historyList');
      if (!historyList.classList.contains('hidden')) {
        log('âœ… PASS: btnToggleHistory í´ë¦­ â†’ ì´ë ¥ íŒ¨ë„ í‘œì‹œ', 'pass');
      } else {
        log('âŒ FAIL: btnToggleHistory í´ë¦­ í›„ íŒ¨ë„ ë¯¸í‘œì‹œ (ì´ë²¤íŠ¸ ë°”ì¸ë”© ì‹¤íŒ¨ ê°€ëŠ¥)', 'fail');
      }

      // btnToggleExclude í´ë¦­ â†’ ì œì™¸ íŒ¨ë„ í‘œì‹œ
      resetFixture();
      document.getElementById('btnToggleExclude').click();

      const excludePanel = document.getElementById('excludePanel');
      if (!excludePanel.classList.contains('hidden')) {
        log('âœ… PASS: btnToggleExclude í´ë¦­ â†’ ì œì™¸ íŒ¨ë„ í‘œì‹œ', 'pass');
      } else {
        log('âŒ FAIL: btnToggleExclude í´ë¦­ í›„ íŒ¨ë„ ë¯¸í‘œì‹œ (ì´ë²¤íŠ¸ ë°”ì¸ë”© ì‹¤íŒ¨ ê°€ëŠ¥)', 'fail');
      }

      // btnThemeToggle í´ë¦­ â†’ data-theme ë³€ê²½
      resetFixture();
      document.getElementById('btnThemeToggle').click();
      await waitFor(0);

      const dataTheme = document.documentElement.getAttribute('data-theme');
      if (dataTheme === 'dark') {
        log('âœ… PASS: btnThemeToggle í´ë¦­ â†’ data-theme="dark" ì„¤ì •', 'pass');
      } else {
        log(`âŒ FAIL: btnThemeToggle í´ë¦­ í›„ data-theme="${dataTheme}" (ì´ë²¤íŠ¸ ë°”ì¸ë”© ì‹¤íŒ¨ ê°€ëŠ¥)`, 'fail');
      }

      // btnResetExclude í´ë¦­ â†’ ì œì™¸ ì´ˆê¸°í™”
      resetFixture();
      toggleExcludeView();
      const grid = document.getElementById('excludeGrid');
      grid.children[0].click();
      grid.children[1].click();

      document.getElementById('btnResetExclude').click();
      await waitFor(0);

      if (getExcludedNumbers().length === 0) {
        log('âœ… PASS: btnResetExclude í´ë¦­ â†’ ì œì™¸ ë²ˆí˜¸ ì´ˆê¸°í™”', 'pass');
      } else {
        log('âŒ FAIL: btnResetExclude í´ë¦­ í›„ ì œì™¸ ë²ˆí˜¸ ë¯¸ì´ˆê¸°í™” (ì´ë²¤íŠ¸ ë°”ì¸ë”© ì‹¤íŒ¨ ê°€ëŠ¥)', 'fail');
      }

      // btnClearHistory í´ë¦­ â†’ ì´ë ¥ ì‚­ì œ
      resetFixture();
      await saveToHistory([1, 2, 3, 4, 5, 6]);
      const origConfirm = window.confirm;
      const origAlert = window.alert;
      window.confirm = () => true;
      window.alert = () => {};
      document.getElementById('btnClearHistory').click();
      await waitFor(0);

      const remainingHistory = await loadHistory();
      if (remainingHistory.length === 0) {
        log('âœ… PASS: btnClearHistory í´ë¦­ â†’ ì´ë ¥ ì‚­ì œ', 'pass');
      } else {
        log('âŒ FAIL: btnClearHistory í´ë¦­ í›„ ì´ë ¥ ë¯¸ì‚­ì œ (ì´ë²¤íŠ¸ ë°”ì¸ë”© ì‹¤íŒ¨ ê°€ëŠ¥)', 'fail');
      }

      window.confirm = origConfirm;
      window.alert = origAlert;
    }

    // ============================================================
    // H. í…Œë§ˆ ê¸°ëŠ¥ ê²€ì¦
    // ============================================================

    async function testTheme() {
      log('â•â•â• Test 13: í…Œë§ˆ ê¸°ëŠ¥ (save/load/apply/toggle) â•â•â•', 'info');
      resetFixture();

      // 1. saveTheme('dark') â†’ localStorageì— 'dark' ì €ì¥
      saveTheme('dark');
      if (localStorage.getItem(THEME_KEY) === 'dark') {
        log('âœ… PASS: saveTheme("dark") â†’ localStorage ì €ì¥', 'pass');
      } else {
        log('âŒ FAIL: saveTheme("dark") ì €ì¥ ì‹¤íŒ¨', 'fail');
      }

      // 2. loadTheme() â†’ ì €ì¥ëœ 'dark' ë°˜í™˜
      if (loadTheme() === 'dark') {
        log('âœ… PASS: loadTheme() â†’ "dark" ë°˜í™˜', 'pass');
      } else {
        log(`âŒ FAIL: loadTheme() â†’ "${loadTheme()}" (ì˜ˆìƒ: "dark")`, 'fail');
      }

      // 3. saveTheme('light') â†’ loadTheme() â†’ 'light'
      saveTheme('light');
      if (loadTheme() === 'light') {
        log('âœ… PASS: saveTheme("light") â†’ loadTheme() â†’ "light"', 'pass');
      } else {
        log(`âŒ FAIL: loadTheme() â†’ "${loadTheme()}" (ì˜ˆìƒ: "light")`, 'fail');
      }

      // 4. ì €ì¥ê°’ ì—†ìŒ â†’ loadTheme() â†’ 'light' (ê¸°ë³¸ê°’)
      localStorage.removeItem(THEME_KEY);
      const defaultTheme = loadTheme();
      // ì‹œìŠ¤í…œ ë‹¤í¬ëª¨ë“œì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ 'light' ë˜ëŠ” 'dark' ì¤‘ í•˜ë‚˜ì´ë©´ í†µê³¼
      if (defaultTheme === 'light' || defaultTheme === 'dark') {
        log('âœ… PASS: ì €ì¥ê°’ ì—†ìŒ â†’ loadTheme() ê¸°ë³¸ê°’ ë°˜í™˜ ("' + defaultTheme + '")', 'pass');
      } else {
        log(`âŒ FAIL: loadTheme() â†’ "${defaultTheme}" (ìœ íš¨í•˜ì§€ ì•Šì€ ê°’)`, 'fail');
      }

      // 5. applyTheme('dark') â†’ html[data-theme="dark"]
      applyTheme('dark');
      if (document.documentElement.getAttribute('data-theme') === 'dark') {
        log('âœ… PASS: applyTheme("dark") â†’ data-theme="dark"', 'pass');
      } else {
        log('âŒ FAIL: applyTheme("dark") data-theme ë¯¸ì„¤ì •', 'fail');
      }

      // 6. applyTheme('light') â†’ data-theme ì†ì„± ì œê±°
      applyTheme('light');
      if (!document.documentElement.hasAttribute('data-theme')) {
        log('âœ… PASS: applyTheme("light") â†’ data-theme ì†ì„± ì œê±°', 'pass');
      } else {
        log('âŒ FAIL: applyTheme("light") data-theme ë¯¸ì œê±°', 'fail');
      }

      // 7. applyTheme('dark') â†’ btnThemeToggle 'â˜€ï¸'
      applyTheme('dark');
      const btnTheme = document.getElementById('btnThemeToggle');
      if (btnTheme.textContent === 'â˜€ï¸') {
        log('âœ… PASS: applyTheme("dark") â†’ ë²„íŠ¼ í…ìŠ¤íŠ¸ "â˜€ï¸"', 'pass');
      } else {
        log(`âŒ FAIL: ë²„íŠ¼ í…ìŠ¤íŠ¸ "${btnTheme.textContent}" (ì˜ˆìƒ: "â˜€ï¸")`, 'fail');
      }

      // 8. updateThemeToggle('dark') â†’ aria-label 'ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜'
      updateThemeToggle('dark');
      if (btnTheme.getAttribute('aria-label') === 'ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜') {
        log('âœ… PASS: updateThemeToggle("dark") â†’ aria-label "ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜"', 'pass');
      } else {
        log(`âŒ FAIL: aria-label "${btnTheme.getAttribute('aria-label')}"`, 'fail');
      }

      // 9. updateThemeToggle('light') â†’ aria-label 'ë‹¤í¬ ëª¨ë“œ ì „í™˜'
      updateThemeToggle('light');
      if (btnTheme.getAttribute('aria-label') === 'ë‹¤í¬ ëª¨ë“œ ì „í™˜') {
        log('âœ… PASS: updateThemeToggle("light") â†’ aria-label "ë‹¤í¬ ëª¨ë“œ ì „í™˜"', 'pass');
      } else {
        log(`âŒ FAIL: aria-label "${btnTheme.getAttribute('aria-label')}"`, 'fail');
      }

      // 10. toggleTheme() â†’ lightâ†”dark ì „í™˜ + localStorage ì €ì¥
      resetFixture(); // light ìƒíƒœë¡œ ì´ˆê¸°í™”
      toggleTheme();
      if (document.documentElement.getAttribute('data-theme') === 'dark' &&
          localStorage.getItem(THEME_KEY) === 'dark') {
        log('âœ… PASS: toggleTheme() â†’ lightâ†’dark ì „í™˜ + ì €ì¥', 'pass');
      } else {
        log('âŒ FAIL: toggleTheme() ì „í™˜/ì €ì¥ ì‹¤íŒ¨', 'fail');
      }

      resetFixture();
    }

    // ============================================================
    // I. ì œì™¸ ë²ˆí˜¸ ì˜ì†ì„± ê²€ì¦
    // ============================================================

    async function testExcludePersistence() {
      log('â•â•â• Test 14: ì œì™¸ ë²ˆí˜¸ ì˜ì†ì„± (save/load/clear) â•â•â•', 'info');
      resetFixture();

      // 1. ì œì™¸ ë²„íŠ¼ í´ë¦­ â†’ saveExcludedNumbers â†’ localStorageì— JSON ë°°ì—´
      toggleExcludeView();
      const grid = document.getElementById('excludeGrid');
      grid.children[0].click(); // 1ë²ˆ
      grid.children[4].click(); // 5ë²ˆ

      const saved = JSON.parse(localStorage.getItem(EXCLUDED_KEY));
      if (Array.isArray(saved) && saved.includes(1) && saved.includes(5) && saved.length === 2) {
        log('âœ… PASS: ì œì™¸ í´ë¦­ â†’ localStorageì— [1, 5] ì €ì¥', 'pass');
      } else {
        log(`âŒ FAIL: localStorage ì €ì¥ ì˜¤ë¥˜ (${JSON.stringify(saved)})`, 'fail');
      }

      // 2. ë¹ˆ ì œì™¸ â†’ saveExcludedNumbers â†’ '[]' ì €ì¥
      resetFixture();
      toggleExcludeView();
      saveExcludedNumbers();
      const emptySaved = localStorage.getItem(EXCLUDED_KEY);
      if (emptySaved === '[]') {
        log('âœ… PASS: ë¹ˆ ì œì™¸ â†’ "[]" ì €ì¥', 'pass');
      } else {
        log(`âŒ FAIL: ë¹ˆ ì œì™¸ ì €ì¥ ì˜¤ë¥˜ ("${emptySaved}")`, 'fail');
      }

      // 3. localStorageì— ë°ì´í„° ì„¸íŒ… â†’ loadExcludedNumbers â†’ ì •ìƒ ë¡œë“œ
      localStorage.setItem(EXCLUDED_KEY, JSON.stringify([10, 20, 30]));
      const loaded = loadExcludedNumbers();
      if (Array.isArray(loaded) && loaded.length === 3 &&
          loaded.includes(10) && loaded.includes(20) && loaded.includes(30)) {
        log('âœ… PASS: loadExcludedNumbers() â†’ [10, 20, 30] ë¡œë“œ', 'pass');
      } else {
        log(`âŒ FAIL: loadExcludedNumbers() ë¡œë“œ ì˜¤ë¥˜ (${JSON.stringify(loaded)})`, 'fail');
      }

      // 4. ë¹ˆ ì €ì¥ì†Œ â†’ loadExcludedNumbers â†’ ë¹ˆ ë°°ì—´
      localStorage.removeItem(EXCLUDED_KEY);
      const emptyLoaded = loadExcludedNumbers();
      if (Array.isArray(emptyLoaded) && emptyLoaded.length === 0) {
        log('âœ… PASS: ë¹ˆ ì €ì¥ì†Œ â†’ loadExcludedNumbers() â†’ []', 'pass');
      } else {
        log(`âŒ FAIL: ë¹ˆ ì €ì¥ì†Œ ë¡œë“œ ì˜¤ë¥˜ (${JSON.stringify(emptyLoaded)})`, 'fail');
      }

      // 5. ì˜ëª»ëœ JSON â†’ loadExcludedNumbers â†’ ë¹ˆ ë°°ì—´ (ì—ëŸ¬ ë°©ì–´)
      localStorage.setItem(EXCLUDED_KEY, 'not valid json');
      const invalidLoaded = loadExcludedNumbers();
      if (Array.isArray(invalidLoaded) && invalidLoaded.length === 0) {
        log('âœ… PASS: ì˜ëª»ëœ JSON â†’ loadExcludedNumbers() â†’ [] (ì—ëŸ¬ ë°©ì–´)', 'pass');
      } else {
        log(`âŒ FAIL: ì˜ëª»ëœ JSON ë°©ì–´ ì‹¤íŒ¨ (${JSON.stringify(invalidLoaded)})`, 'fail');
      }

      // 6. clearExcludedNumbers â†’ localStorageì— EXCLUDED_KEY ì—†ìŒ
      localStorage.setItem(EXCLUDED_KEY, JSON.stringify([1, 2, 3]));
      clearExcludedNumbers();
      if (localStorage.getItem(EXCLUDED_KEY) === null) {
        log('âœ… PASS: clearExcludedNumbers() â†’ EXCLUDED_KEY ì‚­ì œ', 'pass');
      } else {
        log('âŒ FAIL: clearExcludedNumbers() ì‚­ì œ ì‹¤íŒ¨', 'fail');
      }

      resetFixture();
    }

    // ============================================================
    // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    // ============================================================

    async function runAllTests() {
      clearResults();
      resetFixture();
      log('ğŸš€ DOM/UI í…ŒìŠ¤íŠ¸ ì‹œì‘ (ìˆœìˆ˜ ë¡œì§ì€ CLI: node --test test/test-logic.js)', 'info');
      logSeparator();

      // A. ì´ë ¥ ê´€ë¦¬ - DOM ì˜ì¡´ (async)
      await testClearHistory();          logSeparator();

      // B. DOM ì—°ë™
      testGetSelectedSetCount();         logSeparator();

      // C. ë³µì‚¬ ë° í† ìŠ¤íŠ¸ (async)
      await testCopyFunction();          logSeparator();
      await testToastFunction();         logSeparator();

      // D. DOM ë Œë”ë§
      testDisplayMultipleSets();         logSeparator();
      await testDisplayHistory();        logSeparator();
      await testToggleHistoryView();     logSeparator();

      // E. ë²ˆí˜¸ ì œì™¸ UI
      testExcludeUI();                   logSeparator();
      testExcludeReset();                logSeparator();
      testExcludeWarning();              logSeparator();

      // F. í†µí•© (async)
      await testGenerateLottoNumbers();  logSeparator();

      // G. initApp ì´ë²¤íŠ¸ ë°”ì¸ë”© (async)
      await testInitAppEventBinding();   logSeparator();

      // H. í…Œë§ˆ í…ŒìŠ¤íŠ¸ (async)
      await testTheme();                 logSeparator();

      // I. ì œì™¸ ë²ˆí˜¸ ì˜ì†ì„± (async)
      await testExcludePersistence();    logSeparator();

      // ë¶„í¬ í†µê³„ ì‹œê°í™”
      showDistributionStats();

      // ì •ë¦¬ & ìš”ì•½
      resetFixture();
      showSummary();
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    window.addEventListener('load', () => {
      setTimeout(runAllTests, 300);
    });
  </script>
</body>
</html>
